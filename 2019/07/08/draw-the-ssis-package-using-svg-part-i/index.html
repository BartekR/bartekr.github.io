<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Draw the SSIS package using SVG - part I - BartekR</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.76.5" /><meta property="og:site_name" content="BartekR">
  <meta property="og:title" content="Draw the SSIS package using SVG - part I">
  <meta property="og:description" content="BartekR blog. Previously known as String or binary data would be truncated">
  <meta property="description" content="BartekR blog. Previously known as String or binary data would be truncated">
  <meta property="og:url" content="http://blog.bartekr.net/2019/07/08/draw-the-ssis-package-using-svg-part-i/">
  <meta property="og:type" content="article">
  
    <meta property="og:image" content="http://blog.bartekr.net/img/main/Bartek_SqlSatOslo2019_100x100.png">
  
  
            <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/vs2015.min.css">
          <link rel="stylesheet" href="/css/bundle.min.307f33cd8015e5bab28d6ebda9b400f8d3059bc248b4e60adf4d23469fab5a2b.css" integrity="sha256-MH8zzYAV5bqyjW69qbQA&#43;NMFm8JItOYK300jRp&#43;rWis="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          BartekR blog
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/about" class="nav link"><i class='far fa-id-card'></i> About</a>
        
      
        
          
          <a href="/brinf.wordpress.com" class="nav link"><i class='fab fa-wordpress'></i> Blog [PL]</a>
        
      
        
          
          <a href="/books" class="nav link"><i class='fas fa-book-reader'></i> Books</a>
        
      
        
          
          <a href="/series" class="nav link"><i class='fas fa-newspaper'></i> Series</a>
        
      
        
          
          <a href="/speaking" class="nav link"><i class='fas fa-microphone-alt'></i> Speaking</a>
        
      
      
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    
    <a href="#lang-menu" class="nav lang-toggle" lang="en">en</a>
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  <menu id="lang-menu" class="flyout-menu menu">
  <a href="#" lang="en" class="nav link active"> (en)</a>
  
    
      
    
  
</menu>

  
</header>

    <div id="wrapper">
      <section id="site-intro" class="hidden-single-column">
  <a href="/"><img src="http://blog.bartekr.net/img/main/Bartek_SqlSatOslo2019_100x100.png" class="circle" width="100" alt="BartekR profile pic" /></a>
  <header>
    <h1>BartekR</h1>
  </header>
  <main>
    <p>SQL Server. SSIS. PowerShell. Azure.<br/>1 wife. 1 daughter.3 dogs. 9 cats.</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/BartekR" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>











<li><a href="//www.linkedin.com/in/bartoszratajczyk" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>















<li><a href="//twitter.com/b_ratajczyk" target="_blank" rel="noopener" title="Twitter" class="fab fa-twitter"></a></li>













      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article class="post">
    <header>
  <div class="title">
    
      <h2><a href="/2019/07/08/draw-the-ssis-package-using-svg-part-i/">Draw the SSIS package using SVG - part I</a></h2>
    
    
  </div>
  <div class="meta">
    <time datetime="2019-07-08 00:00:00 &#43;0000 UTC">July 8, 2019</time>
    
    
  </div>
</header>

    <div id="socnet-share">
      





    </div>
    <div class="content">
      
      <p>For one of my projects, I need to draw the content of an SSIS package. It should not be a big problem, as the file contains all the required information. If you need to do something similar - I write a series of posts on how to achieve it using SVG, XSLT transformations and a bit of PowerShell (and maybe something more along the way). All the code <a href="https://github.com/BartekR/blog/tree/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I">is available on GitHub</a>.</p>
<h1 id="the-setup">The setup</h1>
<p>I start with the sample package as on the picture. It has three elements aligned vertically, with <code>AND</code> precedence constraints, evaluated as <em>Success</em>. It also has a small annotation on the side. <a href="http://blog.bartekr.net/wp-content/uploads/2019/07/SSISPackage.png"><img src="images/SSISPackage-300x200.png" alt=""></a> The part responsible for the layout is the tag<code>&lt;DTS:DesignTimeProperties&gt;</code> at the end of the XML, that stores the data as a <code>CDATA</code> section. <a href="http://blog.bartekr.net/wp-content/uploads/2019/07/DTS_DesignTimeProperties.png"><img src="images/DTS_DesignTimeProperties-300x162.png" alt=""></a> For a start, it&rsquo;s enough to save its content to a separate XML file named <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/PackageLayout.xml">PackageLayout.xml</a> and take only one part of it containing the <code>&lt;Package&gt;</code> element and save as <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/Beginning.xml">Beginning.xml</a>.</p>
<p>The last thing is to have some XSLT processor. I use <a href="http://www.saxonica.com/welcome/welcome.xml">Saxon</a> for years, and for the demos, I use the Saxon HE 9.9 .NET version. I will use some of the features of XSLT 2.0, so I skip the XSLT processing used in the browsers as they don&rsquo;t support it.</p>
<p>To run the XSLT transformation, I use <code>Transform.exe</code> with three parameters:</p>
<ul>
<li>-s:&lt;source.xml.file&gt;</li>
<li>-xsl:&lt;xsl.transformations.file&gt;</li>
<li>-o:&lt;generated.svg.file&gt;</li>
</ul>
<p>To ease the process, I create the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/diagram2svg.bat">diagram2svg.bat</a> file, where I provide the path to the Saxon executables (<code>set SAXONPATH=D:\tools\SaxonHE9.9N\bin</code>) and all the commands to produce SVG files, like:</p>
<p>%SAXONPATH%\Transform -s:Sample2.xml -xsl:package2svg.xsl -o:Sample2.svg</p>
<h1 id="the-beginnings">The beginnings</h1>
<p>When I started to prepare the XSLT transformations, I used the Beginning.xml file and prepared the package2svg.xsl file. But not everything wanted to work, so I took a few steps back and started slowly. First - I created a blank SVG file - <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/00.svg">00.svg</a> - just to be sure that I remember how to draw a simple image. Then I took the <code>&lt;NodeLayout&gt;</code> element and put it directly inside the <code>&lt;Objects&gt;</code> to test a simple XSLT transformation. I tested it with the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/01.xml">01.xml</a> and <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/01.xsl">01.xsl</a> files.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>XSLT processing is as follows:</p>
<ul>
<li><code>xsl:stylesheet</code> is 1.0 version (for a start it&rsquo;s enough)</li>
<li><code>xsl:output</code> is indented XML</li>
<li><code>xsl:template match=&quot;/Objects&quot;</code> finds the root element (<code>Objects</code>) of the XML file and prepares the root element of the SVG file; I make the SVG 2.0 version, so I use just the minimum declaration</li>
<li>inside the root element I <code>xsl:apply-templates</code> for the <code>NodeLayout</code> (it&rsquo;s just below the <code>Objects)</code></li>
<li>to draw the node I use the <code>&lt;rect&gt;</code> tag and pass all its attributes as <code>xsl:attribute</code>, because I want to evaluate the expressions</li>
<li>the <code>x</code> and <code>y</code> coordinates are stored inside the <code>TopLeft</code> attribute, and the <code>width</code> and <code>height</code>are inside the <code>Size</code>; they are separated by a comma, so I use <code>substring-before()</code> and <code>substring-after()</code> XSLT functions to get them; the SSIS package starts its coordinate system just like the SVG in the upper left corner of the screen, so I don&rsquo;t have to do sophisticated calculations</li>
<li>I draw the node using light grey colour (<code>fill</code>) with a black border (<code>stroke</code>) of 1px width (<code>stroke-width</code>) and round the corners using 10px measure (<code>rx</code> and <code>ry</code>); a side note - if you don&rsquo;t specify the measure units in SVG <a href="http://tutorials.jenkov.com/svg/svg-coordinate-system.html#coordinate-system-units">it&rsquo;s assumed to be pixels</a></li>
<li>I have a habit that all the SVG elements created with XSLT are grouped using the <code>&lt;g&gt;</code> tag, even if the group contains just one object; it also helps me to deal with the namespaces</li>
<li>the essential part of the template is to use the proper namespace, that&rsquo;s why the full element is <code>&lt;g **xmlns=&quot;http://www.w3.org/2000/svg&quot;**&gt;</code> - if I don&rsquo;t use the namespace, the SVG file will have <code>&lt;g xmlns=&quot;&quot;&gt;</code> as the outcome and will not draw the node</li>
<li>the <code>&lt;g&gt;</code> tag as a wrapper also has an advantage - I specify the namespace only for the one element (in another case I would have to write it for all of them within the <code>xsl:template</code>)</li>
</ul>
<p>&lt;xsl:stylesheet version=&ldquo;1.0&rdquo;
xmlns:xsl=&ldquo;<a href="http://www.w3.org/1999/XSL/Transform%22">http://www.w3.org/1999/XSL/Transform&quot;</a></p>
<blockquote>
</blockquote>
<p>&lt;xsl:output
method=&ldquo;xml&rdquo;
encoding=&ldquo;UTF-8&rdquo;
indent=&ldquo;yes&rdquo; /&gt;</p>
<p>&lt;xsl:template match=&quot;/Objects&rdquo;&gt;</p>
<pre><code>&lt;svg
  xmlns=&quot;http://www.w3.org/2000/svg&quot;
  viewBox = &quot;0 0 1000 600&quot;
&gt;

  &lt;xsl:apply-templates select=&quot;NodeLayout&quot; /&gt;

&lt;/svg&gt;
</code></pre>
<p>&lt;/xsl:template&gt;</p>
<p>&lt;xsl:template match=&ldquo;NodeLayout&rdquo;&gt;</p>
<pre><code>&lt;g xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;

    &lt;rect&gt;
        &lt;xsl:attribute name=&quot;x&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;y&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;rx&quot;&gt;10&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;ry&quot;&gt;10&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;width&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@Size, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;height&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@Size, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;fill&quot;&gt;lightgray&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;stroke&quot;&gt;black&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;stroke-width&quot;&gt;1&lt;/xsl:attribute&gt;
    &lt;/rect&gt;

&lt;/g&gt;
</code></pre>
<p>&lt;/xsl:template&gt;</p>
<p>&lt;/xsl:stylesheet&gt;</p>
<h1 id="the-next-step">The next step</h1>
<p>I can draw the node from the XML document with one level of nesting. But in reality, it has four levels: <code>/Objects/Package/GraphInfo/LayoutInfo/NodeLayout</code> with a <code>&lt;GraphLayout&gt;</code> tag having different namespace(s). Working with namespaces is hard in the beginning, so the next step is to draw the same node, but with four levels of nesting. The example is in the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/02.xml">02.xml</a> and <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/02.xsl">02.xsl</a> files.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>The 02.xsl transformation file has two differences when compared to 01.xsl:</p>
<ul>
<li>the root node now uses <code>xsl:apply-templates</code> to call the <code>Package</code>template</li>
<li>all the descendant nodes call the templates of the child nodes - <code>Package</code> calls <code>LayoutInfo</code>, <code>LayoutInfo</code> calls <code>GraphLayout</code>, and <code>GraphLayout</code> calls <code>NodeLayout</code></li>
<li>the same result I can achieve using <code>xsl:apply-templates=&quot;Package/LayoutInfo/GraphLayout/NodeLayout</code> and <code>xsl:template-match=&quot;Package/LayoutInfo/GraphLayout/NodeLayout&quot;</code> (as in <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/02a.xsl">02a.xsl</a> file), but I may want to decorate the intermediate elements, so I use this construction</li>
</ul>
<p>(&hellip;)
&lt;xsl:apply-templates select=&ldquo;Package&rdquo; /&gt;
(&hellip;)
&lt;xsl:template match=&ldquo;Package&rdquo;&gt;
&lt;xsl:apply-templates select=&ldquo;LayoutInfo&rdquo; /&gt;
&lt;/xsl:template&gt;</p>
<p>&lt;xsl:template match=&ldquo;LayoutInfo&rdquo;&gt;
&lt;xsl:apply-templates select=&ldquo;GraphLayout&rdquo; /&gt;
&lt;/xsl:template&gt;</p>
<p>&lt;xsl:template match=&ldquo;GraphLayout&rdquo;&gt;
&lt;xsl:apply-templates select=&ldquo;NodeLayout&rdquo; /&gt;
&lt;/xsl:template&gt;</p>
<p>Now to the namespace part. The <code>&lt;GraphLayout&gt;</code>item looks like this (skipping the <code>Capacity</code> attribute):</p>
<p>&lt;GraphLayout
xmlns=&ldquo;clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph&rdquo;
xmlns:mssgle=&ldquo;clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph&rdquo;
xmlns:assembly=&ldquo;<a href="http://schemas.microsoft.com/winfx/2006/xaml%22">http://schemas.microsoft.com/winfx/2006/xaml&quot;</a></p>
<blockquote>
</blockquote>
<p>To generate the correct SVG, I have to do two things:</p>
<ul>
<li>add the namespace(s) used in <code>&lt;GraphLayout&gt;</code> to the xsl file</li>
<li>use the namespace in the templates</li>
</ul>
<p>Take a look at the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/03.xsl">03.xsl</a> file:</p>
<ul>
<li>the default namespace of the <code>&lt;GraphLayout&gt;</code> tag has to be added to the <code>xsl:stylesheet</code> declaration and prefixed to use it later; I chose the <code>gl</code> prefix; I can skip the remaining namespaces <code>mssgle</code> and <code>assembly</code> as I don&rsquo;t use them in the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/03.xml">03.xml</a> example</li>
<li>the <code>gl</code> name has to be used in the <code>GraphLayout</code> template and all its descendants</li>
</ul>
<p>&lt;xsl:stylesheet version=&ldquo;1.0&rdquo;
xmlns:xsl=&ldquo;<a href="http://www.w3.org/1999/XSL/Transform%22">http://www.w3.org/1999/XSL/Transform&quot;</a>
<strong>xmlns:gl=&ldquo;clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph&rdquo;</strong></p>
<blockquote>
</blockquote>
<p>(&hellip;)</p>
<pre><code>&lt;xsl:template match=&quot;LayoutInfo&quot;&gt;
    &lt;xsl:apply-templates select=&quot;**gl:GraphLayout**&quot; /&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;**gl:GraphLayout**&quot;&gt;
    &lt;xsl:apply-templates select=&quot;**gl:NodeLayout**&quot; /&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>&lt;xsl:template match=&quot;<strong>gl:NodeLayout</strong>&quot;&gt;
(&hellip;)</p>
<h1 id="the-drawing">The drawing</h1>
<p>Having all the preparation steps completed, I can now draw the Beginning.xml part of the package. I use the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/package2svg.xsl">package2svg.xsl</a> that contains the previously learnt things and expand it with the new elements:</p>
<ul>
<li>the <code>gl:GraphLayout contains `gl:NodeLayout`, `gl:EdgeLayout` and `gl:AnnotationLayout` </code></li>
<li>I want to display the names of the nodes (they are stored as the last part of the path in the <code>Id</code> attribute of the <code>NodeLayout</code>), so I use the <code>&lt;text&gt;</code> element</li>
<li>I position the text inside the node, that&rsquo;s why I add 5 pixels to the <code>x</code> position and calculate about the half of the height of the node for the <code>y</code> position and add about half the height of the font (all based on trial-and-error, I will make it more dynamic later)</li>
<li>To use the calculations, I have to cast the values to <code>number()</code>s</li>
<li>to get the last element of the path, I use the <code>tokenize()</code> function on the <code>Id</code> attribute providing the backslash (escaped) as the separator and save the result to the <code>xsl:variable</code> <code>nodeNameTokens</code></li>
<li>the <code>nodeNameTokens</code> holds the collection, and I&rsquo;m interested only in the last element of it, so I use <code>$nodeNameTokens[last()]</code> for the description of the node</li>
<li>the <code>tokenize()</code> function is available since XSLT 2.0, so I have to change the declaration of the xsl file to <code>xsl:stylesheet version=&quot;2.0&quot;</code></li>
<li>I want to have a light grey background of the image, so I use the trick with <code>&lt;rect width=&quot;100%&quot; height=&quot;100%&quot;&gt;</code> on the whole surface</li>
<li>to draw the edges, I use the <code>&lt;line&gt;</code> tag in the <code>gl:EdgeLayout</code> template; it&rsquo;s a simple package with the straight lines, so I don&rsquo;t care about the drawing the curves</li>
<li>the <code>(x1, y1)</code> and <code>(x2, y2)</code> coordinates are calculated using the <code>TopLeft</code> attribute of the <code>EdgeLayout</code> and the <code>End</code> attribute of the <code>mssgle:Curve</code> (I also added this namespace to the <code>xsl:stylesheet</code> declaration)</li>
<li>the lines of the edges don&rsquo;t connect the elements, so I add the little triangle at the end using the <code>&lt;polygon&gt;</code></li>
<li>the triangle&rsquo;s sides are calculated using the ends of the edges (<code>mssgle:Curve/@End</code>) and the connectors (<code>mssgle:Curve/@EndConnector</code>)</li>
<li>the <code>&lt;polygon&gt;</code> element has the points attribute, where I have to provide the coordinates of the points <code>x,y</code> separated by a space (like: <code>&lt;polygon points=&quot;10,10 10,15 15,15&quot; /&gt;</code>), so I use <code>&lt;xsl:text&gt; &lt;/xsl:text&gt;</code> to put a space between the calculated positions</li>
<li>the <code>AnnotationElement</code> is drawn similarly to the <code>NodeElement</code> with an additional border around it (to see that the rectangle exists); compared to the original package there is a room for improvement in the text positioning</li>
</ul>
<p>&lt;xsl:stylesheet <strong>version=&ldquo;2.0&rdquo;</strong>
xmlns:xsl=&ldquo;<a href="http://www.w3.org/1999/XSL/Transform%22">http://www.w3.org/1999/XSL/Transform&quot;</a>
xmlns:gl=&ldquo;clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph&rdquo;
<strong>xmlns:mssgle=&ldquo;clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph&rdquo;</strong></p>
<blockquote>
</blockquote>
<p>&lt;xsl:output
method=&ldquo;xml&rdquo;
encoding=&ldquo;UTF-8&rdquo;
indent=&ldquo;yes&rdquo; /&gt;</p>
<p>&lt;xsl:template match=&quot;/Objects&rdquo;&gt;</p>
<pre><code>&lt;svg
  xmlns=&quot;http://www.w3.org/2000/svg&quot;
  viewBox = &quot;0 0 600 600&quot;
&gt;
  **&lt;rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;lightgray&quot;/&gt;**

  &lt;xsl:apply-templates select=&quot;Package&quot; /&gt;

&lt;/svg&gt;
</code></pre>
<p>&lt;/xsl:template&gt;</p>
<pre><code>&lt;xsl:template match=&quot;Package&quot;&gt;
    &lt;xsl:apply-templates select=&quot;LayoutInfo&quot; /&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;LayoutInfo&quot;&gt;
    &lt;xsl:apply-templates select=&quot;gl:GraphLayout&quot; /&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match=&quot;gl:GraphLayout&quot;&gt;
    &lt;xsl:apply-templates select=&quot;gl:NodeLayout&quot; /&gt;
    &lt;xsl:apply-templates select=&quot;**gl:EdgeLayout**&quot; /&gt;
    &lt;xsl:apply-templates select=&quot;**gl:AnnotationLayout**&quot; /&gt;
&lt;/xsl:template&gt;
</code></pre>
<p>&lt;xsl:template match=&ldquo;gl:NodeLayout&rdquo;&gt;</p>
<pre><code>&lt;xsl:variable name=&quot;**nodeNameTokens**&quot; select=&quot;**tokenize**(@Id, '\\\\')&quot; /&gt;

&lt;g xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;

    &lt;rect&gt;
        &lt;xsl:attribute name=&quot;x&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;y&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;rx&quot;&gt;10&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;ry&quot;&gt;10&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;width&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@Size, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;height&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@Size, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;fill&quot;&gt;white&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;stroke&quot;&gt;black&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;stroke-width&quot;&gt;1&lt;/xsl:attribute&gt;
    &lt;/rect&gt;

    &lt;text&gt;
        &lt;xsl:attribute name=&quot;x&quot;&gt;&lt;xsl:value-of select=&quot;number(substring-before(@TopLeft, ',')) + 5&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;y&quot;&gt;&lt;xsl:value-of select=&quot;number(substring-after(@TopLeft, ',')) + (number(substring-after(@Size, ',')) div 2) + 7&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;fill&quot;&gt;black&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;font-family&quot;&gt;Verdana&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;font-size&quot;&gt;12&lt;/xsl:attribute&gt;
        &lt;xsl:value-of select=&quot;**$nodeNameTokens\[last()\]**&quot;/&gt;
    &lt;/text&gt;

&lt;/g&gt;
</code></pre>
<p>&lt;/xsl:template&gt;</p>
<p>&lt;xsl:template match=&ldquo;gl:EdgeLayout&rdquo;&gt;</p>
<pre><code>&lt;g xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;

    &lt;line&gt;
        &lt;xsl:attribute name=&quot;x1&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;y1&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;style&quot;&gt;stroke:#006600&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;x2&quot;&gt;&lt;xsl:value-of select=&quot;number(substring-before(@TopLeft, ',')) + number(substring-before(gl:EdgeLayout.Curve/mssgle:Curve/@End, ','))&quot;/&gt;&lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;y2&quot;&gt;&lt;xsl:value-of select=&quot;number(substring-after(@TopLeft, ',')) + number(substring-after(gl:EdgeLayout.Curve/mssgle:Curve/@End, ','))&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;/line&gt;

    &lt;polygon&gt;
        &lt;xsl:attribute name=&quot;points&quot;&gt;
            &lt;xsl:value-of select=&quot;number(substring-before(@TopLeft, ',')) + number(substring-before(gl:EdgeLayout.Curve/mssgle:Curve/@End, ',')) - 3&quot;/&gt;,&lt;xsl:value-of select=&quot;number(substring-after(@TopLeft, ',')) + number(substring-after(gl:EdgeLayout.Curve/mssgle:Curve/@End, ','))&quot;/&gt;
            &lt;xsl:text&gt; &lt;/xsl:text&gt;
            &lt;xsl:value-of select=&quot;number(substring-before(@TopLeft, ',')) + number(substring-before(gl:EdgeLayout.Curve/mssgle:Curve/@End, ',')) + 3&quot;/&gt;,&lt;xsl:value-of select=&quot;number(substring-after(@TopLeft, ',')) + number(substring-after(gl:EdgeLayout.Curve/mssgle:Curve/@End, ','))&quot;/&gt; 
            &lt;xsl:text&gt; &lt;/xsl:text&gt;
            &lt;xsl:value-of select=&quot;number(substring-before(@TopLeft, ',')) + number(substring-before(gl:EdgeLayout.Curve/mssgle:Curve/@EndConnector, ','))&quot;/&gt;,&lt;xsl:value-of select=&quot;number(substring-after(@TopLeft, ',')) + number(substring-after(gl:EdgeLayout.Curve/mssgle:Curve/@EndConnector, ','))&quot;/&gt;
        &lt;/xsl:attribute&gt;
        &lt;xsl:attribute name=&quot;style&quot;&gt;stroke:#006600; fill:#006600&lt;/xsl:attribute&gt;
    &lt;/polygon&gt;

&lt;/g&gt;
</code></pre>
<p>&lt;/xsl:template&gt;</p>
<p>&lt;xsl:template match=&ldquo;gl:AnnotationLayout&rdquo;&gt;</p>
<pre><code>&lt;g xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
  &lt;text&gt;
    &lt;xsl:attribute name=&quot;x&quot;&gt;&lt;xsl:value-of select=&quot;number(substring-before(@TopLeft, ','))&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;y&quot;&gt;&lt;xsl:value-of select=&quot;number(substring-after(@TopLeft, ',')) + (number(substring-after(@Size, ',')) div 2)&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;fill&quot;&gt;black&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;font-family&quot;&gt;Verdana&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;font-size&quot;&gt;12&lt;/xsl:attribute&gt;
    &lt;xsl:value-of select=&quot;@Text&quot;/&gt;
  &lt;/text&gt;

  &lt;rect&gt;
    &lt;xsl:attribute name=&quot;x&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;y&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@TopLeft, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;width&quot;&gt;&lt;xsl:value-of select=&quot;substring-before(@Size, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;height&quot;&gt;&lt;xsl:value-of select=&quot;substring-after(@Size, ',')&quot;/&gt;&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;fill&quot;&gt;none&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;stroke&quot;&gt;black&lt;/xsl:attribute&gt;
    &lt;xsl:attribute name=&quot;stroke-width&quot;&gt;1&lt;/xsl:attribute&gt;
  &lt;/rect&gt;
&lt;/g&gt;
</code></pre>
<p>&lt;/xsl:template&gt;</p>
<p>&lt;/xsl:stylesheet&gt;</p>
<h1 id="the-result">The result</h1>
<p><a href="http://blog.bartekr.net/wp-content/uploads/2019/07/GeneratedSVG.png"><img src="images/GeneratedSVG-300x206.png" alt=""></a> <a href="http://blog.bartekr.net/wp-content/uploads/2019/07/SSISPackage.png"><img src="images/SSISPackage-300x200.png" alt=""></a></p>
<p>The current drawing does not look that nice as the original SSIS, but hey - it&rsquo;s the same layout! So, let&rsquo;s draw something more complicated - the sequences with the elements aligned horizontally, vertically, with split paths:</p>
<p><a href="http://blog.bartekr.net/wp-content/uploads/2019/07/SequencesExample.png"><img src="images/SequencesExample-300x120.png" alt=""></a></p>
<p>The plan of the image is stored in the <a href="https://github.com/BartekR/blog/blob/master/201907%20Draw%20SSIS%20package%20using%20SVG%20part%20I/Sample2.xml">Sample2.xml</a> file. When I run the transformation using diagram2svg.xsl file I get the following:</p>
<p><a href="http://blog.bartekr.net/wp-content/uploads/2019/07/UnexpectedSample2.png"><img src="images/UnexpectedSample2-300x140.png" alt=""></a></p>
<p>No sequences, some elements are hidden, no path annotations. A mess. I knew I did not implement all the features, but I wanted to see the aligned nodes. Well, not this time. Adding the sequence objects, curved arrows and cleaning the XSLT, to get a picture below is a subject for the next part of the series.</p>
<p><a href="http://blog.bartekr.net/wp-content/uploads/2019/07/ExpectedSample.png"><img src="images/ExpectedSample-300x114.png" alt=""></a></p>

    </div>
    <footer>
      <div class="stats">
  
    <ul class="categories">
      <li>None</li>
    </ul>
  
  
    <ul class="tags">
      <li>None</li>
    </ul>
  
</div>

    </footer>
  </article>
  
    

  
  <div class="pagination">
    
      <a href="/2019/07/16/draw-the-ssis-package-using-svg-part-ii/" class="button left"><span>Draw the SSIS Package using SVG - part II</span></a>
    
    
      <a href="/2018/11/05/working-with-properties-in-ssisunit/" class="button right"><span>Working with properties in ssisUnit</span></a>
    
  </div>

      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent Posts</h1>
      </header>
      
      <article class="mini-post">
          <a href="/2020/09/24/using-the-system-oauth-token-in-azure-devops/" class="image" style="--bg-image: url('http://blog.bartekr.net/2020/09/24/using-the-system-oauth-token-in-azure-devops/images/203Error.png');">
    <img src="http://blog.bartekr.net/2020/09/24/using-the-system-oauth-token-in-azure-devops/images/203Error.png" alt="">
  </a>
        <header>
          <h2><a href="/2020/09/24/using-the-system-oauth-token-in-azure-devops/">Using the system OAuth token in Azure DevOps</a></h2>
          <time class="published" datetime="2020-09-24 00:00:00 &#43;0000 UTC">September 24, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/2020/09/01/have-problems-with-docker-desktop-for-windows-home-yeah-me-too/" class="image" style="--bg-image: url('http://blog.bartekr.net/2020/09/01/have-problems-with-docker-desktop-for-windows-home-yeah-me-too/images/DockerDesktop.png');">
    <img src="http://blog.bartekr.net/2020/09/01/have-problems-with-docker-desktop-for-windows-home-yeah-me-too/images/DockerDesktop.png" alt="">
  </a>
        <header>
          <h2><a href="/2020/09/01/have-problems-with-docker-desktop-for-windows-home-yeah-me-too/">Have problems with Docker Desktop for Windows Home? Yeah, me too!</a></h2>
          <time class="published" datetime="2020-09-01 00:00:00 &#43;0000 UTC">September 1, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/2020/05/19/adding-a-new-task-in-tfs-azure-devops-using-excel/" class="image" style="--bg-image: url('http://blog.bartekr.net/2020/05/19/adding-a-new-task-in-tfs-azure-devops-using-excel/images/AzureDevOps_TeamPlugin.png');">
    <img src="http://blog.bartekr.net/2020/05/19/adding-a-new-task-in-tfs-azure-devops-using-excel/images/AzureDevOps_TeamPlugin.png" alt="">
  </a>
        <header>
          <h2><a href="/2020/05/19/adding-a-new-task-in-tfs-azure-devops-using-excel/">Adding a new task in TFS (Azure DevOps) using Excel</a></h2>
          <time class="published" datetime="2020-05-19 00:00:00 &#43;0000 UTC">May 19, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/2020/05/04/adding-a-new-task-in-tfs-using-c/" class="image" style="--bg-image: url('http://blog.bartekr.net/2020/05/04/adding-a-new-task-in-tfs-using-c/images/tbl_Field.png');">
    <img src="http://blog.bartekr.net/2020/05/04/adding-a-new-task-in-tfs-using-c/images/tbl_Field.png" alt="">
  </a>
        <header>
          <h2><a href="/2020/05/04/adding-a-new-task-in-tfs-using-c/">Adding a new Task in TFS using C#</a></h2>
          <time class="published" datetime="2020-05-04 00:00:00 &#43;0000 UTC">May 4, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
          
        <header>
          <h2><a href="/2019/08/07/draw-the-ssis-package-using-svg-part-iii/">Draw the SSIS Package using SVG - part III</a></h2>
          <time class="published" datetime="2019-08-07 00:00:00 &#43;0000 UTC">August 7, 2019</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/post/" class="button">See More</a>
        </footer>
      
    </section>
  

  
    

      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>Bartekr 01</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
  <p class="copyright">
    Â© 2020 BartekR
      <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.76.5' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/powershell.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/languages/csharp.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script><script src="/js/bundle.min.b4e669fa428a81defb8af0916c53f39cd1b8e0bbab22199c06f0b182907ba474.js" integrity="sha256-tOZp&#43;kKKgd77ivCRbFPznNG44LurIhmcBvCxgpB7pHQ="></script>
    <script src="/js/add-on.js"></script>
    </div>
  </body>
</html>
