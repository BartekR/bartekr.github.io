<!DOCTYPE html>
<html lang="en-gb" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="When you deploy SSIS project basically you have two options - right click on project name and standalone tool (let&rsquo;s skip SMO and stuff). Both mean the same: IsDeploymentWizard.exe. I was curious what happens during deployment and why mode/Silent finishes deployment very quickly, so I started digging. First I prepared sample SSIS project. Nothing extraordinary - just 5 packages, 6 project parameters and no connection managers (who needs them anyway?). Each package contained empty Data Flow Task - so you see that all just to compile something more than a single package.">
<title>What happens during SSIS deployments?</title>

<link rel='canonical' href='https://blog.bartekr.net/2017/05/03/what-happens-during-ssis-deployments/'>

<link rel="stylesheet" href="/scss/style.min.e8c7fca7d1c9294aa7a4f3426c225ee26540f7d94e39be0b5a4a5c8a49ca5a25.css"><meta property='og:title' content="What happens during SSIS deployments?">
<meta property='og:description' content="When you deploy SSIS project basically you have two options - right click on project name and standalone tool (let&rsquo;s skip SMO and stuff). Both mean the same: IsDeploymentWizard.exe. I was curious what happens during deployment and why mode/Silent finishes deployment very quickly, so I started digging. First I prepared sample SSIS project. Nothing extraordinary - just 5 packages, 6 project parameters and no connection managers (who needs them anyway?). Each package contained empty Data Flow Task - so you see that all just to compile something more than a single package.">
<meta property='og:url' content='https://blog.bartekr.net/2017/05/03/what-happens-during-ssis-deployments/'>
<meta property='og:site_name' content='BartekR'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='internals' /><meta property='article:tag' content='IsDeploymentWizard' /><meta property='article:tag' content='ISServerExec' /><meta property='article:tag' content='SSIS' /><meta property='article:published_time' content='2017-05-03T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2017-05-03T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="What happens during SSIS deployments?">
<meta name="twitter:description" content="When you deploy SSIS project basically you have two options - right click on project name and standalone tool (let&rsquo;s skip SMO and stuff). Both mean the same: IsDeploymentWizard.exe. I was curious what happens during deployment and why mode/Silent finishes deployment very quickly, so I started digging. First I prepared sample SSIS project. Nothing extraordinary - just 5 packages, 6 project parameters and no connection managers (who needs them anyway?). Each package contained empty Data Flow Task - so you see that all just to compile something more than a single package.">
    <link rel="shortcut icon" href="/favicon.ico" />

  

<style>
     
    :root {
        --article-font-family: "Roboto", var(--base-font-family);
    }
</style>

<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap";
    
        customFont.type = "text/css";
        customFont.rel = "stylesheet";
    
        document.head.appendChild(customFont);
    }());
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/Bartek_SqlSatOslo2019_100x100_huc95037055e21b687f52ff80813407d9d_14060_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">BartekR</a></h1>
            <p class="site-description">Azure. PowerShell. SQL. DevOps.<br />1 wife. 1 kid. 4 dogs. 9 cats.</p>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/BartekR'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/b_ratajczyk'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about' >
                
                
                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://brinf.wordpress.com' >
                
                
                
                <span>Blog [PL]</span>
            </a>
        </li>
        
        
        <li >
            <a href='/series' >
                
                
                
                <span>Series</span>
            </a>
        </li>
        
        
        <li >
            <a href='/books' >
                
                
                
                <span>Books</span>
            </a>
        </li>
        
        
        <li >
            <a href='/speaking' >
                
                
                
                <span>Speaking</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories' >
                
                
                
                <span>Categories</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags' >
                
                
                
                <span>Tags</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search' >
                
                
                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ssis-internals/" >
                SSIS Internals
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/2017/05/03/what-happens-during-ssis-deployments/">What happens during SSIS deployments?</a>
        </h2>
    
        

        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 03, 2017</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    16 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>When you deploy SSIS project basically you have two options - right click on project name and standalone tool (let&rsquo;s skip SMO and stuff). Both mean the same: <code>IsDeploymentWizard.exe</code>. I was curious what happens during deployment and why mode<code>/Silent</code> finishes deployment very quickly, so I started digging.</p>
<p>First I prepared sample SSIS project. Nothing extraordinary - just 5 packages, 6 project parameters and no connection managers (who needs them anyway?). Each package contained empty Data Flow Task - so you see that all just to compile something more than a single package. Later during tests, I added connection managers, but they were treated the same as project parameters, so I skipped them (the same with package parameters). To observe the environment I used good old SQL Profiler and <a class="link" href="https://technet.microsoft.com/en-us/sysinternals/processexplorer.aspx"  target="_blank" rel="noopener"
    >Process Explorer</a>.</p>
<p>First - the SQL Profiler. I prepared only two operations to capture:</p>
<ul>
<li>RPC:Completed</li>
<li>SQL:BatchCompleted</li>
</ul>
<p>Didn&rsquo;t set up the columns, just accepted the defaults and hit <em>Run</em>. On a busy machine I could use a filter on Application Name column (<em>Like: SSIS%</em> - two applications are involved). As the result I got 27 lines of T-SQL commands</p>
<p><a class="link" href="images/Profiler01.png" >
<img src="images/Profiler01-1024x487.png"
	width="1024"
	height="487"
	srcset="/2017/05/03/what-happens-during-ssis-deployments/images/Profiler01-1024x487_hubb7e5403bb468913ec9f5267549567d8_328668_480x0_resize_box_3.png 480w, /2017/05/03/what-happens-during-ssis-deployments/images/Profiler01-1024x487_hubb7e5403bb468913ec9f5267549567d8_328668_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Profiler output"
	
	
		class="gallery-image" 
		data-flex-grow="210"
		data-flex-basis="504px"
	
>

</a></p>
<p>What do we have here? First ten lines are five commands repeated two times. They check for the server version and settings. At first they are called when deployment wizard starts and connects to the <em>SSISDB</em> to check if everything is OK. The second time it starts the whole deployment procedure. The lines are:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- ========= 1 =========
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Check for server environment
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =====================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">edition</span><span class="w"> </span><span class="n">sysname</span><span class="p">;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="o">@</span><span class="n">edition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="n">SERVERPROPERTY</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;EDITION&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sysname</span><span class="p">);</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="o">@</span><span class="n">edition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;SQL Azure&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s1">&#39;DatabaseEngineType&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">SERVERPROPERTY</span><span class="p">(</span><span class="s1">&#39;EngineEdition&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">DatabaseEngineEdition</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">if</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">all_objects</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dm_os_host_info&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">is_ms_shipped</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">begin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">host_platform</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">dm_os_host_info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;Windows&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">host_platform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ========= 2 =========
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get server name
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =====================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="n">SERVERPROPERTY</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;servername&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ========= 3 =========
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get SSIS Catalog information
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =====================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT Name from @t_catalogs) AS [Name],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT EncryptionAlgorithm from @t_catalogs) AS [EncryptionAlgorithm],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT SchemaVersion from @t_catalogs) AS [SchemaVersion],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT SchemaBuild from @t_catalogs) AS [SchemaBuild],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT OperationLogRetentionTime from @t_catalogs) AS [OperationLogRetentionTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT MaxProjectVersions from @t_catalogs) AS [MaxProjectVersions],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT OperationCleanupEnabled from @t_catalogs) AS [OperationCleanupEnabled],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT VersionCleanupEnabled from @t_catalogs) AS [VersionCleanupEnabled],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT ServerLoggingLevel from @t_catalogs) AS [ServerLoggingLevel],
</span></span></span><span class="line"><span class="cl"><span class="s1">(SELECT ServerCustomizedLoggingLevel from @t_catalogs) AS [ServerCustomizedLoggingLevel]
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_0)&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ========== 4 ==========
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get terget folder information
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/CatalogFolder[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(folders.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">folders.[folder_id] AS [FolderId],
</span></span></span><span class="line"><span class="cl"><span class="s1">folders.[name] AS [Name],
</span></span></span><span class="line"><span class="cl"><span class="s1">folders.[description] AS [Description],
</span></span></span><span class="line"><span class="cl"><span class="s1">folders.[created_by_sid] AS [CreatedBySid],
</span></span></span><span class="line"><span class="cl"><span class="s1">folders.[created_by_name] AS [CreatedByName],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (folders.[created_time] AS datetime) AS [CreatedDate]
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM
</span></span></span><span class="line"><span class="cl"><span class="s1">[SSISDB].[catalog].[folders] AS folders
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">((SELECT Name from @t_catalogs)=@_msparam_0)and((CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_1))&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;SSISDB&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_1</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ========== 5 ==========
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get target project information
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/CatalogFolder[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(folders.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/ProjectInfo[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(projects.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[project_id] AS [ProjectId],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[folder_id] AS [FolderId],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[name] AS [Name],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[description] AS [Description],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[project_format_version] AS [ProjectFormatVersion],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[deployed_by_sid] AS [DeployedBySid],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[deployed_by_name] AS [DeployedByName],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[last_deployed_time] AS datetime) AS [LastDeployedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[created_time] AS datetime) AS [CreatedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[object_version_lsn] AS [ObjectVersionLsn],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[validation_status] AS [ValidationStatus],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[last_validation_time] AS datetime) AS [LastValidationTime]
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM
</span></span></span><span class="line"><span class="cl"><span class="s1">[SSISDB].[catalog].[folders] AS folders
</span></span></span><span class="line"><span class="cl"><span class="s1">INNER JOIN [SSISDB].[catalog].[projects] AS projects ON projects.[folder_id]=folders.[folder_id]
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">(folders.[name]=@_msparam_0)and(((SELECT Name from @t_catalogs)=@_msparam_1)and((CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_2)))&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_1</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;SSISDB&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_2</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span></code></pre></div><p>When I run the steps 3, 4, 5 I got those results (pivoted for better readability):</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Step 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]</td>
</tr>
<tr>
<td>Name</td>
<td>SSISDB</td>
</tr>
<tr>
<td>EncryptionAlgorithm</td>
<td>AES_256</td>
</tr>
<tr>
<td>SchemaVersion</td>
<td>5</td>
</tr>
<tr>
<td>SchemaBuild</td>
<td>14.0.500.272</td>
</tr>
<tr>
<td>OperationLogRetentionTime</td>
<td>365</td>
</tr>
<tr>
<td>MaxProjectVersions</td>
<td>10</td>
</tr>
<tr>
<td>OperationCleanupEnabled</td>
<td>1</td>
</tr>
<tr>
<td>VersionCleanupEnabled</td>
<td>1</td>
</tr>
<tr>
<td>ServerLoggingLevel</td>
<td>1</td>
</tr>
<tr>
<td>ServerCustomizedLoggingLevel</td>
<td></td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Step 4</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]/CatalogFolder[@Name=&lsquo;Test&rsquo;]</td>
</tr>
<tr>
<td>FolderId</td>
<td>1</td>
</tr>
<tr>
<td>Name</td>
<td>Test</td>
</tr>
<tr>
<td>Description</td>
<td></td>
</tr>
<tr>
<td>CreatedBySid</td>
<td>0x0105000000000005150000003418BD4E479DAA9DB7F7C36DF4010000</td>
</tr>
<tr>
<td>CreatedByName</td>
<td>WIN-LFVELR2F095\Administrator</td>
</tr>
<tr>
<td>CreatedDate</td>
<td>2017-04-23 12:31:23.030</td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Step 5</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]/CatalogFolder[@Name=&lsquo;Test&rsquo;]/ProjectInfo[@Name=&lsquo;TestSSIS&rsquo;]</td>
</tr>
<tr>
<td>ProjectId</td>
<td>1</td>
</tr>
<tr>
<td>FolderId</td>
<td>1</td>
</tr>
<tr>
<td>Name</td>
<td>TestSSIS</td>
</tr>
<tr>
<td>Description</td>
<td></td>
</tr>
<tr>
<td>ProjectFormatVersion</td>
<td>1</td>
</tr>
<tr>
<td>DeployedBySid</td>
<td>0x0105000000000005150000003418BD4E479DAA9DB7F7C36DF4010000</td>
</tr>
<tr>
<td>DeployedByName</td>
<td>WIN-LFVELR2F095\Administrator</td>
</tr>
<tr>
<td>LastDeployedTime</td>
<td>30.04.2017 01:30</td>
</tr>
<tr>
<td>CreatedTime</td>
<td>23.04.2017 12:32</td>
</tr>
<tr>
<td>ObjectVersionLsn</td>
<td>14</td>
</tr>
<tr>
<td>ValidationStatus</td>
<td>N</td>
</tr>
<tr>
<td>LastValidationTime</td>
<td>NULL</td>
</tr>
</tbody>
</table></div>
<p>Excellent. What next? Until now the commands were issued by <em>SSIS Deployment Wizard</em> application. Next few lines come from <em>SSIS ISServerExec</em>. The first one is pretty simple, yet I have to think more about it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;SELECT [operation_id] FROM [catalog].[operations] WHERE [operation_id] = @operation_id AND [status] = @status&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@operation_id bigint,@status int&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">operation_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">@</span><span class="n">status</span><span class="o">=</span><span class="mi">2</span><span class="w">
</span></span></span></code></pre></div><p>The question is: how does the <em>SSIS ISServerExec</em> proces know the value of <code>@operation_id</code>? <code>@status = 2</code> means it checks if <a class="link" href="https://docs.microsoft.com/en-us/sql/integration-services/system-views/catalog-operations-ssisdb-database"  target="_blank" rel="noopener"
    >process is running</a>.</p>
<p>To get the answer we have to take a closer look at the profiler output. The entire deployment finishes in 7 seconds, so it&rsquo;s hard to spot, but when I did I asked myself why I didn&rsquo;t see it before?</p>
<p><a class="link" href="images/Profiler03.png" >
<img src="images/Profiler03-1024x425.png"
	width="1024"
	height="425"
	srcset="/2017/05/03/what-happens-during-ssis-deployments/images/Profiler03-1024x425_hu7a64b84027880f3056612a7d1ad27e1d_389626_480x0_resize_box_3.png 480w, /2017/05/03/what-happens-during-ssis-deployments/images/Profiler03-1024x425_hu7a64b84027880f3056612a7d1ad27e1d_389626_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Profiler output"
	
	
		class="gallery-image" 
		data-flex-grow="240"
		data-flex-basis="578px"
	
>

</a></p>
<p>To tell you the truth I saw the operations times just after analysing <code>catalog.deploy_project</code> procedure (see the line starting with <code>declare @p4</code>). It has a WHILE loop inside waiting for some output. But output coming from what?</p>
<p>The <em>SSIS ISServerExec</em> data in the profiler window (3 - 20:49:30) is shown before the deployment process start (2 - 20:49:28). Suddenly all becomes clear - <code>catalog.deploy_project</code> waits for <em>ISServerExec</em> to finish its job. It checks for deployment status each second and finishes when the status is set as not running (<code>@status &lt;&gt; 2</code>). So, to analyse the process I have to start with the line (2). <code>@project_stream</code> is cut for readability.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">p4</span><span class="w"> </span><span class="nb">bigint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">set</span><span class="w"> </span><span class="o">@</span><span class="n">p4</span><span class="o">=</span><span class="k">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">SSISDB</span><span class="p">].[</span><span class="k">catalog</span><span class="p">].[</span><span class="n">deploy_project</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">folder_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">project_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">project_stream</span><span class="o">=`</span><span class="mi">0</span><span class="n">x504B03041400000008002E</span><span class="o">`&lt;</span><span class="p">...</span><span class="o">&gt;</span><span class="p">,</span><span class="o">@</span><span class="n">operation_id</span><span class="o">=@</span><span class="n">p4</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="o">@</span><span class="n">p4</span><span class="w">
</span></span></span></code></pre></div><p>Afterwards I noted that if I used RPC:Starting event I would spot it earlier - the starting event is before start of <em>ISServerExec</em>.</p>
<p>The main part of the deployment has started and now we are on <em>SSIS ISServerExec</em> side. The next line gets project binary data provided by <code>catalog.deploy_project</code> .</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">get_project_internal</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">project_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="w">
</span></span></span></code></pre></div><p>As a result, we get our project stream (<code>0x504B03041400000008002E...)</code> What&rsquo;s interesting - this command is run by another user - the NTUserName column in Profiler shows SID <code>S-1-9-3...</code> We can check what user is this using simple conversion, but I was lazy and just <a class="link" href="http://wermspowke.blogspot.com/2013/03/converting-sql-server-sids-to-login.html"  target="_blank" rel="noopener"
    >used the script I found on the internet</a>. The SID points to <code>AllSchemaUser</code> user in <code>SSISDB</code> database. And when we take a look into <code>internal.get_project_internal</code> procedure we see, that it&rsquo;s run in a context of <code>AllSchemaUser</code>.</p>
<p><a class="link" href="images/internal.get_project_internal.png" >
<img src="images/internal.get_project_internal.png"
	width="752"
	height="383"
	srcset="/2017/05/03/what-happens-during-ssis-deployments/images/internal.get_project_internal_hu7e319d07eef17a2cfced5d04d593594b_28500_480x0_resize_box_3.png 480w, /2017/05/03/what-happens-during-ssis-deployments/images/internal.get_project_internal_hu7e319d07eef17a2cfced5d04d593594b_28500_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="GetProjectInternal stored procedure header"
	
	
		class="gallery-image" 
		data-flex-grow="196"
		data-flex-basis="471px"
	
>

</a></p>
<p>The next commands insert package data into <code>internal.packages</code> table using <code>internal.append_packages</code> procedure and custom table type <code>internal.PackageTableType</code>. The information comes from the project stream. As the <code>.ispac</code> is just a zip file with different extension the <em>SSIS ISServerExec</em> unpacks it and gets the content.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">declare</span><span class="w"> </span><span class="o">@</span><span class="n">p3</span><span class="w"> </span><span class="n">internal</span><span class="p">.</span><span class="n">PackageTableType</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">p3</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;Package01.dtsx&#39;</span><span class="p">,</span><span class="s1">&#39;EB3054D0-31D0-4476-A922-EC9CE30789DB&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;33FD504B-57AB-4659-A4D5-F1336537A3A6&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">p3</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;Package05.dtsx&#39;</span><span class="p">,</span><span class="s1">&#39;412802DC-3D72-43E3-9D7D-BF731685676A&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;29869950-CA90-4D54-BA4E-1AFD2DE6794E&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">p3</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;Package04.dtsx&#39;</span><span class="p">,</span><span class="s1">&#39;C57A813A-32CB-485D-9B34-8AFA5797B825&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;7B4935B4-C59E-4F89-80C1-8D9C17C3E5E3&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">p3</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;Package03.dtsx&#39;</span><span class="p">,</span><span class="s1">&#39;149A4EFF-05A6-4F3E-AB85-F7C07D271B37&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;2880FA80-E65A-4153-8EE3-BDB71A35FF60&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">@</span><span class="n">p3</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="n">N</span><span class="s1">&#39;Package02.dtsx&#39;</span><span class="p">,</span><span class="s1">&#39;A2D88A81-51B7-433B-9B11-696478AC0594&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;4B68DACB-EE94-4580-95EF-4FF62BFCF121&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_packages</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">packages_data</span><span class="o">=@</span><span class="n">p3</span><span class="w">
</span></span></span></code></pre></div><p>Then we add all parameters with <code>internal.append_parameter</code> procedure. We have six project parameters (and zero connection managers, zero package parameters) so we call it six times. Each procedure execution is made in another database call, so if we have a lot of parameters then we do a lot of single database queries. If we had connection managers and package parameters they would be also added with <code>internal.append_parameter</code>. With a small remark - each part of the connection string is treated as a different parameter.</p>
<p>All the information go to the <code>internal.object_parameters</code> table.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_parameter</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">object_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">object_type</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Parameter1&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_data_type</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Int32&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">required</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="k">sensitive</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">design_default_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">value_set</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_parameter</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">object_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">object_type</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Parameter2&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_data_type</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;String&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">required</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="k">sensitive</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">design_default_value</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">value_set</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_parameter</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">object_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">object_type</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Parameter3&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_data_type</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;UInt32&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">required</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="k">sensitive</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">design_default_value</span><span class="o">=</span><span class="mi">333</span><span class="p">,</span><span class="o">@</span><span class="n">value_set</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_parameter</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">object_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">object_type</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Parameter4&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_data_type</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">required</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="k">sensitive</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">design_default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">value_set</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_parameter</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">object_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">object_type</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Parameter5&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_data_type</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Single&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">required</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="k">sensitive</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">design_default_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">@</span><span class="n">value_set</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">append_parameter</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">object_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">object_type</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_name</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Parameter6&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">parameter_data_type</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Int64&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">required</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="k">sensitive</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">design_default_value</span><span class="o">=</span><span class="mi">666666</span><span class="p">,</span><span class="o">@</span><span class="n">value_set</span><span class="o">=</span><span class="mi">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">go</span><span class="w">
</span></span></span></code></pre></div><p>Aside sample of sample ADO.NET connection manager parametrization:</p>
<p>
<img src="images/Profiler02-1024x392.png"
	width="1024"
	height="392"
	srcset="/2017/05/03/what-happens-during-ssis-deployments/images/Profiler02-1024x392_hu9355b4a2fd9f99869a55cb3ef6b43234_292890_480x0_resize_box_3.png 480w, /2017/05/03/what-happens-during-ssis-deployments/images/Profiler02-1024x392_hu9355b4a2fd9f99869a55cb3ef6b43234_292890_1024x0_resize_box_3.png 1024w"
	loading="lazy"
	
		alt="Profiler output"
	
	
		class="gallery-image" 
		data-flex-grow="261"
		data-flex-basis="626px"
	
>

</p>
<p>OK. Parameters set up. Now a piece of code I don&rsquo;t fully understand. It runs a synchronisation of parameters between latest project version and currently deployed version:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">sync_parameter_versions</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">project_id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">@</span><span class="n">object_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="w">
</span></span></span></code></pre></div><p>What I don&rsquo;t get is why do we sync current version with the latest version, when the current version is already the latest? I don&rsquo;t think it has something with concurrent deployments as the procedures start transactions in SERIALIZABLE isolation level. Will have to investigate it further.</p>
<p>Almost the end. The last command run as <em>SSIS ISServerExec</em> application is updating the deployment status as a great success (<code>@status = 7</code>). Looks like nothing fancy, just simple update, but there&rsquo;s a bit of logic there, including cleanup in case of failed deployment. This procedure is also run as <code>AllSchemaUser</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">update_project_deployment_status</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">status</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="o">@</span><span class="n">end_time</span><span class="o">=</span><span class="s1">&#39;2017-04-26 20:49:30.8732399 +02:00&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">operation_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">@</span><span class="n">project_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">project_format_version</span><span class="o">=</span><span class="mi">1</span><span class="w">
</span></span></span></code></pre></div><p>When project deployment finishes <em>SSIS Deployment Wizard</em> takes control back. It fires four dynamic SQL statements. First two are identical - they check for deployment operation information (I don;t know why the same code run twice), the third checks for projects in a folder and then iterates through each project to get its data. I have one project in my folder, so it is just one SQL statement. If I had more projects I would get a separate statement for each of them (checked with another project).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get operation details
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/Operation[@Id=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(ops.[operation_id], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[operation_id] AS [Id],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[operation_type] AS [OperationType],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (ops.[created_time] AS datetime) AS [CreatedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[object_type] AS [ObjectType],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[object_id] AS [ObjectId],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[object_name] AS [ObjectName],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[status] AS [Status],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (ops.[start_time] AS datetime) AS [StartTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (ops.[end_time] AS datetime) AS [EndTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[caller_sid] AS [CallerSid],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[caller_name] AS [CallerName],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[process_id] AS [ProcessId],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[stopped_by_sid] AS [StoppedBySid],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[stopped_by_name] AS [StoppedByName]
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM
</span></span></span><span class="line"><span class="cl"><span class="s1">[SSISDB].[catalog].[operations] AS ops
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">(ops.[operation_id]=@_msparam_0)and(((SELECT Name from @t_catalogs)=@_msparam_1)and((CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_2)))&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_1</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;SSISDB&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_2</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get operation details (again)
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/Operation[@Id=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(ops.[operation_id], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[operation_id] AS [Id],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[operation_type] AS [OperationType],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (ops.[created_time] AS datetime) AS [CreatedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[object_type] AS [ObjectType],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[object_id] AS [ObjectId],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[object_name] AS [ObjectName],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[status] AS [Status],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (ops.[start_time] AS datetime) AS [StartTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (ops.[end_time] AS datetime) AS [EndTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[caller_sid] AS [CallerSid],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[caller_name] AS [CallerName],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[process_id] AS [ProcessId],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[stopped_by_sid] AS [StoppedBySid],
</span></span></span><span class="line"><span class="cl"><span class="s1">ops.[stopped_by_name] AS [StoppedByName]
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM
</span></span></span><span class="line"><span class="cl"><span class="s1">[SSISDB].[catalog].[operations] AS ops
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">(ops.[operation_id]=@_msparam_0)and(((SELECT Name from @t_catalogs)=@_msparam_1)and((CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_2)))&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_1</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;SSISDB&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_2</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get all projects from the folder
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/CatalogFolder[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(folders.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/ProjectInfo[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(projects.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[project_id] AS [ProjectId],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[folder_id] AS [FolderId],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[name] AS [Name],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[description] AS [Description],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[project_format_version] AS [ProjectFormatVersion],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[deployed_by_sid] AS [DeployedBySid],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[deployed_by_name] AS [DeployedByName],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[last_deployed_time] AS datetime) AS [LastDeployedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[created_time] AS datetime) AS [CreatedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[object_version_lsn] AS [ObjectVersionLsn],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[validation_status] AS [ValidationStatus],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[last_validation_time] AS datetime) AS [LastValidationTime]
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM
</span></span></span><span class="line"><span class="cl"><span class="s1">[SSISDB].[catalog].[folders] AS folders
</span></span></span><span class="line"><span class="cl"><span class="s1">INNER JOIN [SSISDB].[catalog].[projects] AS projects ON projects.[folder_id]=folders.[folder_id]
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">(folders.[name]=@_msparam_0)and(((SELECT Name from @t_catalogs)=@_msparam_1)and((CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_2)))&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_1</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;SSISDB&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_2</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Get project details
</span></span></span><span class="line"><span class="cl"><span class="c1">-- =======================
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="n">N</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">        --Preparing to access the Catalog object
</span></span></span><span class="line"><span class="cl"><span class="s1">        DECLARE @t_catalogs TABLE (
</span></span></span><span class="line"><span class="cl"><span class="s1">        Name sysname COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        EncryptionAlgorithm nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaVersion int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        SchemaBuild nvarchar(256) COLLATE SQL_Latin1_General_CP1_CI_AS,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationLogRetentionTime int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        MaxProjectVersions int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        OperationCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        VersionCleanupEnabled bit,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerLoggingLevel int,
</span></span></span><span class="line"><span class="cl"><span class="s1">        ServerCustomizedLoggingLevel nvarchar(128))
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">        IF DB_ID(&#39;&#39;SSISDB&#39;&#39;) IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s1">        BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s1">        INSERT INTO @t_catalogs VALUES(
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;&#39;SSISDB&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;ENCRYPTION_ALGORITHM&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_VERSION&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SCHEMA_BUILD&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;RETENTION_WINDOW&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;MAX_PROJECT_VERSIONS&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;OPERATION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS BIT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;VERSION_CLEANUP_ENABLED&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT CAST([property_value] AS INT) FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name]  = N&#39;&#39;SERVER_LOGGING_LEVEL&#39;&#39;),
</span></span></span><span class="line"><span class="cl"><span class="s1">        (SELECT [property_value] FROM [SSISDB].[catalog].[catalog_properties] WHERE [property_name] = N&#39;&#39;SERVER_CUSTOMIZED_LOGGING_LEVEL&#39;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">        )
</span></span></span><span class="line"><span class="cl"><span class="s1">        END
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">SELECT
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;IntegrationServices[@Name=&#39;&#39; + quotename(CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname),&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;]&#39;&#39; + &#39;&#39;/Catalog[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE((SELECT Name from @t_catalogs), &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/CatalogFolder[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(folders.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; + &#39;&#39;/ProjectInfo[@Name=&#39;&#39; + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + REPLACE(projects.[name], &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;, &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;) + &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39; + &#39;&#39;]&#39;&#39; AS [Urn],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[project_id] AS [ProjectId],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[folder_id] AS [FolderId],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[name] AS [Name],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[description] AS [Description],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[project_format_version] AS [ProjectFormatVersion],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[deployed_by_sid] AS [DeployedBySid],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[deployed_by_name] AS [DeployedByName],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[last_deployed_time] AS datetime) AS [LastDeployedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[created_time] AS datetime) AS [CreatedTime],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[object_version_lsn] AS [ObjectVersionLsn],
</span></span></span><span class="line"><span class="cl"><span class="s1">projects.[validation_status] AS [ValidationStatus],
</span></span></span><span class="line"><span class="cl"><span class="s1">CAST (projects.[last_validation_time] AS datetime) AS [LastValidationTime]
</span></span></span><span class="line"><span class="cl"><span class="s1">FROM
</span></span></span><span class="line"><span class="cl"><span class="s1">[SSISDB].[catalog].[folders] AS folders
</span></span></span><span class="line"><span class="cl"><span class="s1">INNER JOIN [SSISDB].[catalog].[projects] AS projects ON projects.[folder_id]=folders.[folder_id]
</span></span></span><span class="line"><span class="cl"><span class="s1">WHERE
</span></span></span><span class="line"><span class="cl"><span class="s1">(projects.[name]=@_msparam_0)and((folders.[name]=@_msparam_1)and(((SELECT Name from @t_catalogs)=@_msparam_2)and((CAST(SERVERPROPERTY(N&#39;&#39;Servername&#39;&#39;) AS sysname)=@_msparam_3))))&#39;</span><span class="p">,</span><span class="n">N</span><span class="s1">&#39;@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000),@_msparam_3 nvarchar(4000)&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_0</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;TestSSIS&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_1</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_2</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;SSISDB&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">_msparam_3</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;WIN-LFVELR2F095&#39;</span><span class="w">
</span></span></span></code></pre></div><p>And the results are:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Get operation details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]/Operation[@Id=&lsquo;5&rsquo;]</td>
</tr>
<tr>
<td>Id</td>
<td>5</td>
</tr>
<tr>
<td>OperationType</td>
<td>101</td>
</tr>
<tr>
<td>CreatedTime</td>
<td>26.04.2017 20:49</td>
</tr>
<tr>
<td>ObjectType</td>
<td>20</td>
</tr>
<tr>
<td>ObjectId</td>
<td>1</td>
</tr>
<tr>
<td>ObjectName</td>
<td>TestSSIS</td>
</tr>
<tr>
<td>Status</td>
<td>7</td>
</tr>
<tr>
<td>StartTime</td>
<td>26.04.2017 20:49</td>
</tr>
<tr>
<td>EndTime</td>
<td>26.04.2017 20:49</td>
</tr>
<tr>
<td>CallerSid</td>
<td>0x0105000000000005150000003418BD4E479DAA9DB7F7C36DF4010000</td>
</tr>
<tr>
<td>CallerName</td>
<td>WIN-LFVELR2F095\Administrator</td>
</tr>
<tr>
<td>ProcessId</td>
<td>7144</td>
</tr>
<tr>
<td>StoppedBySid</td>
<td>NULL</td>
</tr>
<tr>
<td>StoppedByName</td>
<td>NULL</td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Get operation details (again)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]/Operation[@Id=&lsquo;5&rsquo;]</td>
</tr>
<tr>
<td>Id</td>
<td>5</td>
</tr>
<tr>
<td>OperationType</td>
<td>101</td>
</tr>
<tr>
<td>CreatedTime</td>
<td>26.04.2017 20:49</td>
</tr>
<tr>
<td>ObjectType</td>
<td>20</td>
</tr>
<tr>
<td>ObjectId</td>
<td>1</td>
</tr>
<tr>
<td>ObjectName</td>
<td>TestSSIS</td>
</tr>
<tr>
<td>Status</td>
<td>7</td>
</tr>
<tr>
<td>StartTime</td>
<td>26.04.2017 20:49</td>
</tr>
<tr>
<td>EndTime</td>
<td>26.04.2017 20:49</td>
</tr>
<tr>
<td>CallerSid</td>
<td>0x0105000000000005150000003418BD4E479DAA9DB7F7C36DF4010000</td>
</tr>
<tr>
<td>CallerName</td>
<td>WIN-LFVELR2F095\Administrator</td>
</tr>
<tr>
<td>ProcessId</td>
<td>7144</td>
</tr>
<tr>
<td>StoppedBySid</td>
<td>NULL</td>
</tr>
<tr>
<td>StoppedByName</td>
<td>NULL</td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Get all projects from the folder</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]/CatalogFolder[@Name=&lsquo;Test&rsquo;]/ProjectInfo[@Name=&lsquo;TestSSIS&rsquo;]</td>
</tr>
<tr>
<td>ProjectId</td>
<td>1</td>
</tr>
<tr>
<td>FolderId</td>
<td>1</td>
</tr>
<tr>
<td>Name</td>
<td>TestSSIS</td>
</tr>
<tr>
<td>Description</td>
<td></td>
</tr>
<tr>
<td>ProjectFormatVersion</td>
<td>1</td>
</tr>
<tr>
<td>DeployedBySid</td>
<td>0x0105000000000005150000003418BD4E479DAA9DB7F7C36DF4010000</td>
</tr>
<tr>
<td>DeployedByName</td>
<td>WIN-LFVELR2F095\Administrator</td>
</tr>
<tr>
<td>LastDeployedTime</td>
<td>03.05.2017 09:32</td>
</tr>
<tr>
<td>CreatedTime</td>
<td>23.04.2017 12:32</td>
</tr>
<tr>
<td>ObjectVersionLsn</td>
<td>25</td>
</tr>
<tr>
<td>ValidationStatus</td>
<td>N</td>
</tr>
<tr>
<td>LastValidationTime</td>
<td>NULL</td>
</tr>
</tbody>
</table></div>
<div class="table-wrapper"><table>
<thead>
<tr>
<th></th>
<th>Get project details</th>
</tr>
</thead>
<tbody>
<tr>
<td>Urn</td>
<td>IntegrationServices[@Name=&lsquo;WIN-LFVELR2F095&rsquo;]/Catalog[@Name=&lsquo;SSISDB&rsquo;]/CatalogFolder[@Name=&lsquo;Test&rsquo;]/ProjectInfo[@Name=&lsquo;TestSSIS&rsquo;]</td>
</tr>
<tr>
<td>ProjectId</td>
<td>1</td>
</tr>
<tr>
<td>FolderId</td>
<td>1</td>
</tr>
<tr>
<td>Name</td>
<td>TestSSIS</td>
</tr>
<tr>
<td>Description</td>
<td></td>
</tr>
<tr>
<td>ProjectFormatVersion</td>
<td>1</td>
</tr>
<tr>
<td>DeployedBySid</td>
<td>0x0105000000000005150000003418BD4E479DAA9DB7F7C36DF4010000</td>
</tr>
<tr>
<td>DeployedByName</td>
<td>WIN-LFVELR2F095\Administrator</td>
</tr>
<tr>
<td>LastDeployedTime</td>
<td>03.05.2017 09:32</td>
</tr>
<tr>
<td>CreatedTime</td>
<td>23.04.2017 12:32</td>
</tr>
<tr>
<td>ObjectVersionLsn</td>
<td>25</td>
</tr>
<tr>
<td>ValidationStatus</td>
<td>N</td>
</tr>
<tr>
<td>LastValidationTime</td>
<td>NULL</td>
</tr>
</tbody>
</table></div>
<p>The last operation in deployment process is run by <em>SSIS ISServerExec Crash Handler</em>. It&rsquo;s almost the same command as the previous by <em>SSIS ISServerExec</em>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">exec</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">update_project_deployment_status</span><span class="p">]</span><span class="w"> </span><span class="o">@</span><span class="n">status</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="o">@</span><span class="n">end_time</span><span class="o">=</span><span class="s1">&#39;2017-04-26 20:49:32.7510757 +02:00&#39;</span><span class="p">,</span><span class="o">@</span><span class="n">operation_id</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">@</span><span class="n">project_version_lsn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">@</span><span class="n">description</span><span class="o">=</span><span class="n">N</span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span></code></pre></div><p>The difference is it doesn&rsquo;t contain <code>@project_format_version parameter</code>, sets different <code>@status</code> (4 = failed) and - of course - <code>@end_time</code>. And - it does nothing.</p>
<p>Well, it would set deployment status as failed if there was something wrong with the process, but the <code>internal.update_project_deployment_status</code> has a condition - it runs only:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="p">[</span><span class="n">operation_id</span><span class="p">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">internal</span><span class="p">].[</span><span class="n">operations</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">([</span><span class="n">status</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">[</span><span class="n">status</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">OR</span><span class="w"> </span><span class="p">[</span><span class="n">status</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w"> </span><span class="p">[</span><span class="n">operation_id</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">@</span><span class="n">operation_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">[</span><span class="n">operation_type</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">101</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><p>So if the process finished properly (<code>@status = 7</code>) nothing happens. I made the tests few times and sometimes te last step of <em>ISServerExec</em> process finished before the end of the <code>catalog.deploy_project</code> procedure.</p>
<p>The last thing to check is why <em>IsDeploymentWizard</em> finishes deployment so quickly and what happens behind the scenes.</p>
<p>To answer for the latter - it does the same steps as manual deployment. And how it does it so quickly? It just doesn&rsquo;t wait for the outcome before returning to console. But it still runs it the background. Look at the <code>cmd.exe</code> process on the top and <code>sqlservr.exe</code> process at the bottom. Click the picture to see the details.</p>
<p><a class="link" href="images/IsDeploymentWizard.gif" >
<img src="images/IsDeploymentWizard-1024x440.gif"
	width="1024"
	height="440"
	srcset="/2017/05/03/what-happens-during-ssis-deployments/images/IsDeploymentWizard-1024x440_hua56dd2c3b873835b512de07e05634d1d_90485_480x0_resize_box_1.gif 480w, /2017/05/03/what-happens-during-ssis-deployments/images/IsDeploymentWizard-1024x440_hua56dd2c3b873835b512de07e05634d1d_90485_1024x0_resize_box_1.gif 1024w"
	loading="lazy"
	
		alt="IsDeploymentWizard demo"
	
	
		class="gallery-image" 
		data-flex-grow="232"
		data-flex-basis="558px"
	
>

</a></p>
<p>And that&rsquo;s all. So:</p>
<ul>
<li><code>/Silent</code> mode just returns to the console right after the process start</li>
<li>deployment involves two processes: <em>IsDeploymentWizard</em> and <em>ISServerExec</em></li>
<li>the <em>IsDeploymentWizard</em> waits until <em>ISServerExec</em> finishes its work checking the status within the <code>WHILE</code> loop on 1 second intervals</li>
<li>if the proces finished with success the last operation by <em>ISServerExec Crash handler</em> does nothing.</li>
</ul>
<p>The communication between <em>SSISDB</em> and <em>ISServerExec</em> (and <em>ISServerExec</em> itself) is a great candidate for another post in near future.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/internals/">Internals</a>
        
            <a href="/tags/isdeploymentwizard/">IsDeploymentWizard</a>
        
            <a href="/tags/isserverexec/">ISServerExec</a>
        
            <a href="/tags/ssis/">SSIS</a>
        
    </section>


    </footer>


    
</article>

    

    

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="BartekR/bartekr.github.io"
        issue-term="url"
        
        label="blog-comment"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2017 - 
        
        2024 BartekR
    </section>
    
    <section class="powerby">
        
            (c) Bartosz Ratajczyk <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
