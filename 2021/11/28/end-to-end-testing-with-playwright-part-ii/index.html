<!DOCTYPE html>
<html lang="en-gb" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="In the first part I created a sample Blazor app, installed Playwright and created first test. This post is to get more comfortable with Playwright. Getting more familiar\rJust to recall the test I wrote (validation of the element on a /counter web page): using Microsoft.Playwright.NUnit; using System.Threading.Tasks; namespace BlazorApp.Tests; class MainPageTests : PageTest { public async Task CounterStartsWithZero() { // call to the `/counter` page await Page.GotoAsync(&#34;http://localhost:5165/counter&#34;); // search for the counter value var content = await Page.">
<title>End-to-End testing with Playwright, part II</title>

<link rel='canonical' href='https://blog.bartekr.net/2021/11/28/end-to-end-testing-with-playwright-part-ii/'>

<link rel="stylesheet" href="/scss/style.min.e8c7fca7d1c9294aa7a4f3426c225ee26540f7d94e39be0b5a4a5c8a49ca5a25.css"><meta property='og:title' content="End-to-End testing with Playwright, part II">
<meta property='og:description' content="In the first part I created a sample Blazor app, installed Playwright and created first test. This post is to get more comfortable with Playwright. Getting more familiar\rJust to recall the test I wrote (validation of the element on a /counter web page): using Microsoft.Playwright.NUnit; using System.Threading.Tasks; namespace BlazorApp.Tests; class MainPageTests : PageTest { public async Task CounterStartsWithZero() { // call to the `/counter` page await Page.GotoAsync(&#34;http://localhost:5165/counter&#34;); // search for the counter value var content = await Page.">
<meta property='og:url' content='https://blog.bartekr.net/2021/11/28/end-to-end-testing-with-playwright-part-ii/'>
<meta property='og:site_name' content='BartekR'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='playwright' /><meta property='article:tag' content='nunit' /><meta property='article:tag' content='c#' /><meta property='article:published_time' content='2021-11-28T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-11-28T00:00:00&#43;00:00'/><meta property='og:image' content='https://blog.bartekr.net/2021/11/28/end-to-end-testing-with-playwright-part-ii/images/Header.png' />
<meta name="twitter:title" content="End-to-End testing with Playwright, part II">
<meta name="twitter:description" content="In the first part I created a sample Blazor app, installed Playwright and created first test. This post is to get more comfortable with Playwright. Getting more familiar\rJust to recall the test I wrote (validation of the element on a /counter web page): using Microsoft.Playwright.NUnit; using System.Threading.Tasks; namespace BlazorApp.Tests; class MainPageTests : PageTest { public async Task CounterStartsWithZero() { // call to the `/counter` page await Page.GotoAsync(&#34;http://localhost:5165/counter&#34;); // search for the counter value var content = await Page."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://blog.bartekr.net/2021/11/28/end-to-end-testing-with-playwright-part-ii/images/Header.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

  

<style>
     
    :root {
        --article-font-family: "Roboto", var(--base-font-family);
    }
</style>

<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap";
    
        customFont.type = "text/css";
        customFont.rel = "stylesheet";
    
        document.head.appendChild(customFont);
    }());
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/Bartek_SqlSatOslo2019_100x100_huc95037055e21b687f52ff80813407d9d_14060_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">BartekR</a></h1>
            <p class="site-description">SQL Server. SSIS. PowerShell. Azure.<br />1 wife. 1 kid. 5 dogs. 10 cats.</p>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/BartekR'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/b_ratajczyk'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about' >
                
                
                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://brinf.wordpress.com' >
                
                
                
                <span>Blog [PL]</span>
            </a>
        </li>
        
        
        <li >
            <a href='/series' >
                
                
                
                <span>Series</span>
            </a>
        </li>
        
        
        <li >
            <a href='/books' >
                
                
                
                <span>Books</span>
            </a>
        </li>
        
        
        <li >
            <a href='/speaking' >
                
                
                
                <span>Speaking</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories' >
                
                
                
                <span>Categories</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags' >
                
                
                
                <span>Tags</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search' >
                
                
                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#getting-more-familiar">Getting more familiar</a></li>
    <li><a href="#enter-the-eval-world">Enter the Eval world</a></li>
    <li><a href="#a-bit-more-about-expressions">A bit more about expressions</a></li>
    <li><a href="#setting-the-url-once">Setting the URL once</a></li>
    <li><a href="#short-summary">Short summary</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/2021/11/28/end-to-end-testing-with-playwright-part-ii/">
                
                    <img src="/2021/11/28/end-to-end-testing-with-playwright-part-ii/images/Header.png" loading="lazy" alt="Featured image of post End-to-End testing with Playwright, part II" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/testing/" >
                Testing
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/2021/11/28/end-to-end-testing-with-playwright-part-ii/">End-to-End testing with Playwright, part II</a>
        </h2>
    
        

        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Nov 28, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><a class="link" href="https://blog.bartekr.net/2021/11/13/end-to-end-testing-with-playwright-part-i/" >In the first part</a> I created a sample Blazor app, installed Playwright and created first test. This post is to get more comfortable with Playwright.</p>
<h2 id="getting-more-familiar">Getting more familiar
</h2><p>Just to recall the test I wrote (validation of the element on a <code>/counter</code> web page):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.Playwright.NUnit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">BlazorApp.Tests</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MainPageTests</span> <span class="p">:</span> <span class="n">PageTest</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">CounterStartsWithZero</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// call to the `/counter` page</span>
</span></span><span class="line"><span class="cl">        <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">GotoAsync</span><span class="p">(</span><span class="s">&#34;http://localhost:5165/counter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// search for the counter value</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">content</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">TextContentAsync</span><span class="p">(</span><span class="s">&#34;p&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// assertion for the value</span>
</span></span><span class="line"><span class="cl">        <span class="n">Assert</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">&#34;Current count: 0&#34;</span><span class="p">,</span> <span class="n">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Writing subsequent tests is like copy/paste/edit - go to the page, do something, verify if it returns what you expected. As an example - check if I&rsquo;m redirected to the <code>/counter</code> page when I click the link on the main page looks like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[Test]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">ClickingCounterRedirectsToCounterPage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// call to the main page</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">GotoAsync</span><span class="p">(</span><span class="s">&#34;http://localhost:5165/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// search for the counter link and click it</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">ClickAsync</span><span class="p">(</span><span class="s">&#34;text=Counter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// verify redirection</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&#34;xxx&#34;</span><span class="p">,</span> <span class="n">Page</span><span class="p">.</span><span class="n">Url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>Page.ClickAsync()</code> is a void method, so to check whether I was redirected, I check the <code>Page.Url</code> property, as it is <a class="link" href="https://playwright.dev/dotnet/docs/navigations/#navigation-lifecycle"  target="_blank" rel="noopener"
    >updated in the navigation lifecycle</a>. As previously - the first test execution should fail (and also helps to verify what is returned). And it fails:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">Expected string length 3 but was 29. Strings differ at index 0.
</span></span><span class="line"><span class="cl">Expected: <span class="s2">&#34;xxx&#34;</span>
</span></span><span class="line"><span class="cl">But was:  <span class="s2">&#34;http://localhost:5165/counter&#34;</span>
</span></span><span class="line"><span class="cl">-----------<span class="se">^
</span></span></span></code></pre></div><p><code>Page.Url</code> returns the whole URL (I expected that) as a <code>string</code>. I could compare the absolute URLs, but I don&rsquo;t want to. I will use <code>System.Uri</code> to get only a relative part:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[Test]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">ClickingCounterRedirectsToCounterPage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// call to the main page</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">GotoAsync</span><span class="p">(</span><span class="s">&#34;http://localhost:5165/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// search for the counter link and click it</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">ClickAsync</span><span class="p">(</span><span class="s">&#34;text=Counter&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// verify redirection</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="p">.</span><span class="n">Uri</span> <span class="n">pageUri</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Uri</span><span class="p">(</span><span class="n">Page</span><span class="p">.</span><span class="n">Url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&#34;/counter&#34;</span><span class="p">,</span> <span class="n">pageUri</span><span class="p">.</span><span class="n">PathAndQuery</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>OK, I get more or less how it works, and I can dig into the documentation to find out more commands I can use for testing. As an example I can verify other web page&rsquo;s parameters or states (<code>Page.Title</code>, <code>Page.ContentAsync()</code>, <code>Page.IsCheckedAsync()</code>) and test any selector. When I think about a thing I would like to check or test - it&rsquo;s all there. So it boils down to searching a method in the API documentation and using it. Simple. If you want to see more tests - check <a class="link" href="https://github.com/BartekR/blog/tree/master/202111%20E2E%20testing%20with%20Playwright/BlazorApp.Tests"  target="_blank" rel="noopener"
    >the repository</a>.</p>
<p>So I&rsquo;m going to verify something less obvious. The Weather forecast page has a table, and I will prepare some tests to validate it.</p>
<p>
<img src="./images/WeatherForecastTable.png"
	
	
	
	loading="lazy"
	
		alt="Weather forecast table"
	
	
>

</p>
<p>I want to test four things about the table:</p>
<ol>
<li>Does it have five rows with data?</li>
<li>Is the header&rsquo;s font 16px in size?</li>
<li>Is the header&rsquo;s font bold?</li>
<li>Are the dates in ascending order?</li>
</ol>
<h2 id="enter-the-eval-world">Enter the Eval world
</h2><p>To check the information about the given page element I can for example use <code>EvalOnSelectorAsync()</code> / <code>EvalOnSelectorAllAsync()</code> methods. The difference is that the former returns one element (first found in DOM, when there are multiple matches available) or all elements that match the selector. Both functions take at minimum two arguments: <code>selector</code> and <code>expression</code>, and the <code>type</code> it returns: <code>Page.EvalOnSelectorAsync&lt;type&gt;(selector, expression)</code>.</p>
<p>I can also use a <code>Locator()</code> method. It returns a <code>Locator</code> instance instead of <code>ElementHandle</code> as other selector methods (like <code>ClickAsync()</code>, or <code>QuerySelectorAsync()</code>). Locator is more strict, and forces you to return only one element (except for the <code>CountAsync()</code> method, which can handle multiple results). Also, <code>Locator</code> captures how to get to the element, and <code>ElementHandle</code> holds the handle to the element itself.</p>
<p>As an example - to find the numbers of rows in the table on the <code>/fetchdata</code> page, I can write it in a few ways:</p>
<ul>
<li>
<p>find a table and get the row count (including header - returns 6):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tableRows</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAsync</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">&#34;//table&#34;</span><span class="p">,</span> <span class="s">&#34;tbl =&gt; tbl.rows.length&#34;</span><span class="p">);</span>
</span></span></code></pre></div></li>
<li>
<p>find a table&rsquo;s <code>tbody</code> element and get the row count (only data rows - all methods return 5)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tableRows</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAsync</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">&#34;//table/tbody&#34;</span><span class="p">,</span> <span class="s">&#34;tbody =&gt; tbody.childNodes.length&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// or</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tableRows</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAsync</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">&#34;//table/tbody&#34;</span><span class="p">,</span> <span class="s">&#34;tbody =&gt; tbody.childElementCount&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// or</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tableRows</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAsync</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">&#34;//table/tbody&#34;</span><span class="p">,</span> <span class="s">&#34;tbody =&gt; tbody.rows.length&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// or</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tableRows</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAllAsync</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">&#34;//table/tbody/tr&#34;</span><span class="p">,</span> <span class="s">&#34;rows =&gt; rows.length&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// or</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">tableRows</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">Locator</span><span class="p">(</span><span class="s">&#34;//table/tbody/tr&#34;</span><span class="p">).</span><span class="n">CountAsync</span><span class="p">();</span>
</span></span></code></pre></div></li>
</ul>
<p>A short explanation of the code above: each command looks for element(s) that match the selectors (I used XPath selectors <code>//table</code> and <code>//table/body</code>). After the selector is matched, Playwright uses the found element(s) in the expression. The syntax used above utilises lambda expressions, meaning &ldquo;hey, I have something, and I will refer to that something as the thing you see on the left side of the expression, and on the right, side I will show you what to do with it&rdquo;. To look a bit closer, I will take <code>Page.EvalOnSelectorAsync&lt;int&gt;(&quot;//table/tbody&quot;, &quot;el =&gt; el.rows.length&quot;)</code> as an example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAsync</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">&#34;//table/tbody&#34;</span><span class="p">,</span> <span class="s">&#34;el =&gt; el.rows.length&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// selector: &#34;//table/tbody&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// expression: &#34;el =&gt; el.rows.length&#34;</span>
</span></span></code></pre></div><p>The expression means:</p>
<ul>
<li>the selector found some object, I will call it <code>el</code>: &ldquo;<code>el</code> =&gt; &hellip;&rdquo;</li>
<li>take this element <code>el</code> and get me its <code>rows.length</code> property: &ldquo;&hellip; =&gt; <code>el.rows.length</code>&rdquo;</li>
</ul>
<p>To find the dates, I use <code>Locator</code> and <code>InnerTextAsync()</code> to show the syntax. The XPath expressions find the rows, and DateTime operations set the formatted dates as the expected values. Not beautiful, but it works.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[Test]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">TableDatesStartTomorrowAscending</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// call to the `/fetchdata` page</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">GotoAsync</span><span class="p">(</span><span class="s">&#34;http://localhost:5165/fetchdata&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// get number of table rows</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">date1</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">Locator</span><span class="p">(</span><span class="s">&#34;//table/tbody/tr[1]/td[1]&#34;</span><span class="p">).</span><span class="n">InnerTextAsync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">date2</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">Locator</span><span class="p">(</span><span class="s">&#34;//table/tbody/tr[2]/td[1]&#34;</span><span class="p">).</span><span class="n">InnerTextAsync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">date3</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">Locator</span><span class="p">(</span><span class="s">&#34;//table/tbody/tr[3]/td[1]&#34;</span><span class="p">).</span><span class="n">InnerTextAsync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">date4</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">Locator</span><span class="p">(</span><span class="s">&#34;//table/tbody/tr[4]/td[1]&#34;</span><span class="p">).</span><span class="n">InnerTextAsync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">date5</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">Locator</span><span class="p">(</span><span class="s">&#34;//table/tbody/tr[5]/td[1]&#34;</span><span class="p">).</span><span class="n">InnerTextAsync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// assertion for the value</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;dd.MM.yyyy&#34;</span><span class="p">),</span> <span class="n">date1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="m">2</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;dd.MM.yyyy&#34;</span><span class="p">),</span> <span class="n">date2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="m">3</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;dd.MM.yyyy&#34;</span><span class="p">),</span> <span class="n">date3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="m">4</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;dd.MM.yyyy&#34;</span><span class="p">),</span> <span class="n">date4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="m">5</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;dd.MM.yyyy&#34;</span><span class="p">),</span> <span class="n">date5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The last example is a test whether the header&rsquo;s font is 16px. For this I modified an example <a class="link" href="https://playwright.dev/dotnet/docs/assertions/#custom-assertions"  target="_blank" rel="noopener"
    >from the official documentation</a> and used <code>window.getComputedStyle(cell).fontSize</code> expression:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[Test]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">TableHeaderHas16pxFont</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// call to the `/fetchdata` page</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">GotoAsync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">pageUrl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// get number of table rows</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">fontSize</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">EvalOnSelectorAsync</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">&#34;//table/thead/tr/th&#34;</span><span class="p">,</span> <span class="s">&#34;cell =&gt; window.getComputedStyle(cell).fontSize&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// assertion for the value</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&#34;16px&#34;</span><span class="p">,</span> <span class="n">fontSize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Not sure why, but sometimes the tests using <code>window.getComputedStyle()</code> failed when run for the first time. Rerunning them made the tests pass, but it looks unstable and is something to investigate later.</p>
<h2 id="a-bit-more-about-expressions">A bit more about expressions
</h2><p>I can tell which element I want to find, and I can use a few engines (<code>text=...</code> for searching by text, <code>/</code> or <code>XPath=</code> for XPath, <code>css=...</code> for CSS). I know I need to use lambda expressions for the expression part. But how can I check what I can test using the expression? How do I get these <code>rows.length</code>, <code>childElementCount</code>, or <code>window.getComputedStyle(cell).fontSize</code>?</p>
<p>The first option is to use the developer tools in the browser. I click the right mouse button on a given element and select <em>Inspect</em>. I confirm whether the console shows the correct part and then switch to the <em>Properties</em> tab.</p>
<p>
  
  <p style="text-align: center;">
    <img src="./images/InspectBrave.png"
	
	
	
	loading="lazy"
	
		alt="Inspect using Brave browser"
	
	
>
  </p>

</p>
<p>Above, you see the console from the Brave browser. It shows the path to the <code>&lt;tbody&gt;</code> element, and I can see that the <code>rows</code> HTMLCollection has the <code>length</code> property.
The Firefox browser also helps to find the elements using the <em>Search</em> option in the Inspector. Below you see the XPath expression for the <code>&lt;tr&gt;</code> elements in the <code>&lt;tbody&gt;</code>. It also shows 5 found occurrences.</p>
<p>
  
  <p style="text-align: center;">
    <img src="./images/InspectFirefox.png"
	
	
	
	loading="lazy"
	
		alt="Inspect using Firefox browser"
	
	
>
  </p>

</p>
<p><strong>Note</strong>: you can also search within the Brave&rsquo;s (and Edge&rsquo;s/Chrome&rsquo;s) tools by pressing <code>Ctrl</code> + <code>F</code> in the <em>Elements</em> tab</p>
<p>The second option is to go to the official MDN documentation (or other web API documentation of your choice). I use MDN for:</p>
<ul>
<li><a class="link" href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model"  target="_blank" rel="noopener"
    >investigating Document Object Model</a></li>
<li><a class="link" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Properties_Reference"  target="_blank" rel="noopener"
    >searching for JavaScript CSS properties reference</a></li>
</ul>
<h2 id="setting-the-url-once">Setting the URL once
</h2><p>I&rsquo;m sure you have noticed that I repeat the URL in every test. I don&rsquo;t like it either, and it&rsquo;s now the time to clean it up a bit.  I create an additional <code>Init()</code> method for each test class and decorate it with the <code>[Setup]</code> attribute, so it will be called before each test. Inside, I set the <code>pageUrl</code> property, which is then used in the <code>Page.GotoAsync()</code> method:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">string</span> <span class="n">pageUrl</span> <span class="p">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">[SetUp]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">Init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">pageUrl</span> <span class="p">=</span> <span class="s">&#34;http://localhost:5165&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">[Test]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">PageTitleIsIndex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// call to the `/counter` page</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">GotoAsync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">pageUrl</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// get page title</span>
</span></span><span class="line"><span class="cl">    <span class="kt">string</span> <span class="n">title</span> <span class="p">=</span> <span class="k">await</span> <span class="n">Page</span><span class="p">.</span><span class="n">TitleAsync</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// assertion for the value</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="s">&#34;Index&#34;</span><span class="p">,</span> <span class="n">title</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>For now, I will leave like that. I don&rsquo;t like the website&rsquo;s hardcoded address and will fix it in the next part using external configuration.</p>
<p>Sidenotes on the header screenshot:</p>
<ul>
<li>I see the <code>Run Test | Debug Test</code> elements in VSCode only when I open the BlazorApp.Tests folder directly; it does not show when I open the parent folder or add the folder in the workspace (maybe some configuration is invalid/missing?); they show because I have <strong>C#</strong> VSCode extension from Microsoft installed</li>
<li>I use <strong>.NET Core Test Explorer</strong> VSCode extension by Jun Han (more about it in the next part)</li>
<li>I use <strong>Error Lens</strong> VSCode extension by Alexander</li>
</ul>
<h2 id="short-summary">Short summary
</h2><ul>
<li>Playwright has a very clean API, and it gets swift to start using it</li>
<li><code>Locator</code> API looks more intuitive than API returning ElementHandle; I have to investigate and use a bit more</li>
<li>When using <code>window.getComputedStyle(cell)</code> in the <code>EvaluateAsync</code> or <code>EvalOnSelectorAsync</code> I sometimes got errors (like: <code>test returned &lt;String.Empty&gt;</code>); after running the tests again they passed</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/playwright/">Playwright</a>
        
            <a href="/tags/nunit/">Nunit</a>
        
            <a href="/tags/c%23/">C#</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/2021/11/13/end-to-end-testing-with-playwright-part-i/">
        
        

        <div class="article-details">
            <h2 class="article-title">End-to-End testing with Playwright, part I</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo=""
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2017 - 
        
        2024 BartekR
    </section>
    
    <section class="powerby">
        
            (c) Bartosz Ratajczyk <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
