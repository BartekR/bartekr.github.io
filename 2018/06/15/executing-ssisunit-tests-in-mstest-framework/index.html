<!DOCTYPE html>
<html lang="en-gb" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="One of the drawbacks of ssisUnit is that it has only its own test runner. You can run the tests either using GUI or the console application, but the output is not that easy to parse and to present on the report. I&rsquo;m used to working with Pester output or using NUnit/MSTest frameworks that integrates nicely with other tools. In this post, I will show you how to prepare and execute ssisUnit tests using MSTest framework, how to automate this process, and how to run those tests with TFS (or VSTS).">
<title>Executing ssisUnit tests in MSTest framework</title>

<link rel='canonical' href='https://blog.bartekr.net/2018/06/15/executing-ssisunit-tests-in-mstest-framework/'>

<link rel="stylesheet" href="/scss/style.min.e8c7fca7d1c9294aa7a4f3426c225ee26540f7d94e39be0b5a4a5c8a49ca5a25.css"><meta property='og:title' content="Executing ssisUnit tests in MSTest framework">
<meta property='og:description' content="One of the drawbacks of ssisUnit is that it has only its own test runner. You can run the tests either using GUI or the console application, but the output is not that easy to parse and to present on the report. I&rsquo;m used to working with Pester output or using NUnit/MSTest frameworks that integrates nicely with other tools. In this post, I will show you how to prepare and execute ssisUnit tests using MSTest framework, how to automate this process, and how to run those tests with TFS (or VSTS).">
<meta property='og:url' content='https://blog.bartekr.net/2018/06/15/executing-ssisunit-tests-in-mstest-framework/'>
<meta property='og:site_name' content='BartekR'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='MSTest' /><meta property='article:tag' content='ssisUnit' /><meta property='article:tag' content='TFS' /><meta property='article:published_time' content='2018-06-15T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2018-06-15T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Executing ssisUnit tests in MSTest framework">
<meta name="twitter:description" content="One of the drawbacks of ssisUnit is that it has only its own test runner. You can run the tests either using GUI or the console application, but the output is not that easy to parse and to present on the report. I&rsquo;m used to working with Pester output or using NUnit/MSTest frameworks that integrates nicely with other tools. In this post, I will show you how to prepare and execute ssisUnit tests using MSTest framework, how to automate this process, and how to run those tests with TFS (or VSTS).">
    <link rel="shortcut icon" href="/favicon.ico" />

  

<style>
     
    :root {
        --article-font-family: "Roboto", var(--base-font-family);
    }
</style>

<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap";
    
        customFont.type = "text/css";
        customFont.rel = "stylesheet";
    
        document.head.appendChild(customFont);
    }());
</script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/Bartek_SqlSatOslo2019_100x100_huc95037055e21b687f52ff80813407d9d_14060_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">BartekR</a></h1>
            <p class="site-description">SQL Server. SSIS. PowerShell. Azure.<br />1 wife. 1 kid. 5 dogs. 10 cats.</p>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/BartekR'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com/b_ratajczyk'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about' >
                
                
                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://brinf.wordpress.com' >
                
                
                
                <span>Blog [PL]</span>
            </a>
        </li>
        
        
        <li >
            <a href='/series' >
                
                
                
                <span>Series</span>
            </a>
        </li>
        
        
        <li >
            <a href='/books' >
                
                
                
                <span>Books</span>
            </a>
        </li>
        
        
        <li >
            <a href='/speaking' >
                
                
                
                <span>Speaking</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories' >
                
                
                
                <span>Categories</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags' >
                
                
                
                <span>Tags</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search' >
                
                
                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#propertycommand">PropertyCommand</a></li>
    <li><a href="#mstest-part">MSTest part</a></li>
    <li><a href="#there-has-to-be-an-easier-way">There has to be an easier way</a></li>
    <li><a href="#tfs-part">TFS part</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/series/" >
                Series
            </a>
        
            <a href="/categories/testing/" >
                Testing
            </a>
        
            <a href="/categories/learning/" >
                Learning
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/2018/06/15/executing-ssisunit-tests-in-mstest-framework/">Executing ssisUnit tests in MSTest framework</a>
        </h2>
    
        

        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jun 15, 2018</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>One of the drawbacks of ssisUnit is that it has only its own test runner. You can run the tests either using GUI or the console application, but the output is not that easy to parse and to present on the report. I&rsquo;m used to working with Pester output or using NUnit/MSTest frameworks that integrates nicely with other tools. In this post, I will show you how to prepare and execute ssisUnit tests using MSTest framework, how to automate this process, and how to run those tests with TFS (or VSTS).</p>
<p>I work a lot with TFS. It has a neat feature - you can run tests during the build or release and verify how your code is doing. The goal is: I want to run ssisUnit tests of my <a class="link" href="https://github.com/BartekR/ssisUnitLearning"  target="_blank" rel="noopener"
    >ssisUnitLearning project</a> in TFS and see the outcome in the reports.</p>
<p><a class="link" href="images/TFS_TestsDetails.png" >
  
  <p style="text-align: center;">
    <img src="images/TFS_TestsDetails.png"
	
	
	
	loading="lazy"
	
		alt="Test details in TFS"
	
	
>
  </p>

</a></p>
<p>On the picture above three of my four tests failed. Select <em>DFT_LoadUsers</em> test - it failed because of the <em>DefaultBufferMaxRow</em> setting for the <em>Data Flow Task</em>. This test is written for <code>20_DataFlow.dtsx</code> - the package to load the <code>dbo.Users</code> table using <em>Data Flow Task</em>, not <em>SQL Task</em>. There are two settings for the <em>DFT LoadUsers</em> I don&rsquo;t want to be changed: <em>DefaultBufferMaxRows</em> and <em>DelayValidation</em>. Apparently, the number of rows is not set to the required value.</p>
<h2 id="propertycommand">PropertyCommand
</h2><p>To check for the package&rsquo;s setting I use <em>PropertyCommand</em> - it can read almost everything you need from the package. Almost, because it does not read from the _Data Flow Task_s elements, so, for example, you won&rsquo;t read the <em>Derived Column</em>, <em>Conditional Split</em> or <em>OLEDB  Destination</em> parameters. To see what you are able to get or set, take a look at the <code>LocatePropertyValue()</code> method in the <code>PropertyCommand.cs</code> script. At the end you will find some examples, like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">\Package\Sequence Container\Script Task.Properties[Description]
</span></span></code></pre></div><p>And through the method&rsquo;s code, there are string checks for the keywords: <em>Package</em>, <em>Variables</em>, <em>Properties</em>, <em>Connections</em>, <em>EventHandlers</em>. You just have to write the path using one of them.</p>
<p>To verify my <em>DFT_Users</em> task, I use two paths:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">\Package\DFT LoadUsers.Properties[DefaultBufferMaxRows]
</span></span><span class="line"><span class="cl">\Package\DFT LoadUsers.Properties[DelayValidation]
</span></span></code></pre></div><p>Nothing extraordinary, but works. You can use it for example to check the standards of your SSIS packages (like: every task&rsquo;s <em>Description</em> has to be different than the default value or the checkpoint file has the same name as the package, but different extension, &hellip;). The file <code>20_DataFlow.ssisUnit</code> test is located <a class="link" href="https://github.com/BartekR/ssisUnitLearning/tree/master/Tests"  target="_blank" rel="noopener"
    >in the Tests</a> folder. Now, to the</p>
<h2 id="mstest-part">MSTest part
</h2><p><a class="link" href="https://github.com/Microsoft/testfx"  target="_blank" rel="noopener"
    >MSTest v2</a> is the <a class="link" href="https://blogs.msdn.microsoft.com/bharry/2017/03/28/open-sourcing-the-mstest-test-framework/"  target="_blank" rel="noopener"
    >open source</a> test framework by Microsoft. I will not write a lot about it. If you want to learn more - read the excellent <a class="link" href="https://www.meziantou.net/2018/01/22/mstest-v2-setup-a-test-project-and-run-tests"  target="_blank" rel="noopener"
    >blog posts by Gérald Barré</a>.</p>
<p>I took the idea and parts of the code from <a class="link" href="http://www.ravipal.net/2016/03/ssis-unit-testing-with-ssisunit.html"  target="_blank" rel="noopener"
    >Ravi Palihena&rsquo;s blog post</a> about ssisUnit testing and his <a class="link" href="https://github.com/rarpal/SampleSSISUnit"  target="_blank" rel="noopener"
    >GitHub repository</a>. Then I read the source code of the <a class="link" href="https://github.com/BartekR/ssisUnit/tree/master/SsisUnitTestRunner"  target="_blank" rel="noopener"
    >SsisUnitTestRunner</a>, <a class="link" href="https://github.com/BartekR/ssisUnit/tree/master/SsisUnitTestRunnerUI"  target="_blank" rel="noopener"
    >SsisUnitTestRunnerUI</a> and posts by Gérald and changed the tests a bit.</p>
<p>I will use MSTest to execute ssisUnit tests from the file <code>20_DataFlow.ssisUnit</code>. For that, I created a new <em>Visual C# &gt; Test &gt; Unit Test Project (.NET Framework)</em> - <code>ssisUnitLearning.MSTest</code> - within the solution. I also set the reference to the <code>SsisUnit2017.dll</code> and <code>SsisUnitBase.dll</code> libraries and loaded required namespaces</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">SsisUnit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">SsisUnitBase.EventArgs</span><span class="p">;</span>
</span></span></code></pre></div><p>I decided that each test file has its own class with the same name as the name of the ssisUnit file. But the name of the class can&rsquo;t start with the number, so I added a <code>TestUnit</code> prefix. I load the ssisUnit tests at the beginning, and it&rsquo;s enough to do it once, so I add the <code>ClassInitialize</code> attribute to the <code>Init()</code> method. The tests are executed from the <code>.dll</code> file created after compilation, and I chose to load the <code>.ssisUnit</code> file with all the tests using relative path.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[ClassInitialize]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Init</span><span class="p">(</span><span class="n">TestContext</span> <span class="n">tc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ssisUnitLearningMSTest.dll is in subfolder bin\Debug and Tests folder is parallel, that&#39;s why ..\..\..</span>
</span></span><span class="line"><span class="cl">    <span class="n">testSuite</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SsisTestSuite</span><span class="p">(</span><span class="s">@&#34;..\..\..\Tests\01_OnlyParametersAndVariables.ssisUnit&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The <code>Init()</code> method has to follow the rules I got first from the error message: <em>Method ssisUnitLearningMSTest.TestUnit_01_OnlyParametersAndVariables.Init has wrong signature. The method must be static, public, does not return a value and should take a single parameter of type TestContext. Additionally, if you are using async-await in method then return-type must be Task</em>. Also the <code>testSuite</code> parameter, that holds the <code>.ssisUnit</code> file contents has to be static.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="n">SsisTestSuite</span> <span class="n">testSuite</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">SsisUnitBase</span><span class="p">.</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Test</span> <span class="n">test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Context</span> <span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">bool</span> <span class="n">isTestPassed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">messages</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
</span></span></code></pre></div><p>The other variables are:</p>
<ul>
<li><code>testResult</code> holds the result of the ssisUnit test</li>
<li><code>test</code> is the ssisUnit test object</li>
<li><code>context</code> is the ssisUnit test context</li>
<li><code>isTestPassed</code> has the information if the test succeeded</li>
<li><code>messages</code> is a list of all assertions&rsquo; errors in the ssisUnit test</li>
</ul>
<p>Each test is written as a class decorated by the <code>TestMethod</code> attribute. The tests are loaded to the <code>testSuite</code> object, so to get the ssisUnit test I want to run I get it from the <code>Tests</code> dictionary by the name. Then I create the context for it.</p>
<p>ssisUnit uses events and responses. When the assertion completes, the <code>AssertCompleted</code> event is called. I subscribe to this event before running the test and unsubscribe after the test is executed and all asserts are finished. I also set the flag <code>isTestPassed</code> to <code>true</code>. It will be set to <code>false</code> if any of the assertions fail.</p>
<p>In the end, I run two MSTest asserts. The second checks if all the assertions were successful. If not it writes all the error messages. But as I set <code>isTestPassed</code> flag as <code>true</code> in the beginning the MSTest&rsquo;s assert will always return <code>true</code>, even if I don&rsquo;t run the tests. So I added the first assertion to check if the test was executed. This can happen if there are errors in the <code>.ssisUnit</code> or <code>.dtsx</code> file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="na">[TestMethod]</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">void</span> <span class="n">DFT_LoadUsers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">test</span> <span class="p">=</span> <span class="n">testSuite</span><span class="p">.</span><span class="n">Tests</span><span class="p">[</span><span class="s">&#34;DFT LoadUsers&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span> <span class="p">=</span> <span class="n">testSuite</span><span class="p">.</span><span class="n">CreateContext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">testSuite</span><span class="p">.</span><span class="n">AssertCompleted</span> <span class="p">+=</span> <span class="n">TestSuiteAssertCompleted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">isTestPassed</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="n">rs</span> <span class="p">=</span> <span class="n">test</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">testSuite</span><span class="p">.</span><span class="n">AssertCompleted</span> <span class="p">-=</span> <span class="n">TestSuiteAssertCompleted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="s">&#34;Package did not execute&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">isTestPassed</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="s">&#34;;&#34;</span><span class="p">,</span> <span class="n">messages</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The <code>TestSuiteAssertCompleted</code> method verifies the <code>TestExecResult</code> of each assertion and sets the <code>isTestPassed</code> flag. If there is an error, it&rsquo;s added to the messages list.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">TestSuiteAssertCompleted</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">AssertCompletedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">AssertName</span> <span class="p">!=</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">testResult</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">isTestPassed</span> <span class="p">=</span> <span class="n">isTestPassed</span> <span class="p">&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">.</span><span class="n">TestPassed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">.</span><span class="n">TestPassed</span> <span class="p">==</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">messages</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">AssertName</span> <span class="p">+</span> <span class="s">&#34; failed: &#34;</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">.</span><span class="n">TestResultMsg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a class="link" href="https://github.com/BartekR/ssisUnitLearning/blob/master/ssisUnitLearning.MSTest/TestUnit_20_DataFlow.cs"  target="_blank" rel="noopener"
    >The full code</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">SsisUnit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">SsisUnitBase.EventArgs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="nn">Microsoft.VisualStudio.TestTools.UnitTesting</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">namespace</span> <span class="nn">ssisUnitLearningMSTestExample</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="na">    [TestClass]</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">class</span> <span class="nc">TestUnit_20_DataFlow</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kd">static</span> <span class="n">SsisTestSuite</span> <span class="n">testSuite</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">SsisUnitBase</span><span class="p">.</span><span class="n">TestResult</span> <span class="n">testResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Test</span> <span class="n">test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Context</span> <span class="n">context</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">bool</span> <span class="n">isTestPassed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">List</span> <span class="n">messages</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">        [ClassInitialize]</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Init</span><span class="p">(</span><span class="n">TestContext</span> <span class="n">tc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ssisUnitLearningMSTest.dll is in subfolder bin\\Debug and Tests folder is parallel, that&#39;s why ..\..\..</span>
</span></span><span class="line"><span class="cl">            <span class="n">testSuite</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SsisTestSuite</span><span class="p">(</span><span class="s">@&#34;..\..\..\Tests\20_DataFlow.ssisUnit&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="k">void</span> <span class="n">TestSuiteAssertCompleted</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">AssertCompletedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">AssertName</span> <span class="p">!=</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">testResult</span> <span class="p">=</span> <span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">isTestPassed</span> <span class="p">=</span> <span class="n">isTestPassed</span> <span class="p">&amp;</span> <span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">.</span><span class="n">TestPassed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">.</span><span class="n">TestPassed</span> <span class="p">==</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">messages</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">AssertName</span> <span class="p">+</span> <span class="s">&#34; failed: &#34;</span> <span class="p">+</span> <span class="n">e</span><span class="p">.</span><span class="n">TestExecResult</span><span class="p">.</span><span class="n">TestResultMsg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">        [TestMethod]</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="k">void</span> <span class="n">DFT_LoadUsers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">test</span> <span class="p">=</span> <span class="n">testSuite</span><span class="p">.</span><span class="n">Tests</span><span class="p">[</span><span class="s">&#34;DFT LoadUsers&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span> <span class="p">=</span> <span class="n">testSuite</span><span class="p">.</span><span class="n">CreateContext</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">testSuite</span><span class="p">.</span><span class="n">AssertCompleted</span> <span class="p">+=</span> <span class="n">TestSuiteAssertCompleted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">isTestPassed</span> <span class="p">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="kt">bool</span> <span class="n">rs</span> <span class="p">=</span> <span class="n">test</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">testSuite</span><span class="p">.</span><span class="n">AssertCompleted</span> <span class="p">-=</span> <span class="n">TestSuiteAssertCompleted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">rs</span><span class="p">,</span> <span class="s">&#34;Package did not execute&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="n">isTestPassed</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">String</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="s">&#34;;&#34;</span><span class="p">,</span> <span class="n">messages</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="there-has-to-be-an-easier-way">There has to be an easier way
</h2><p>In the beginning, I created two MSTest files - first for <code>01_OnlyParametersAndVariables.ssisUnit</code> and second for <code>20_DataFlow.ssisUnit</code>. Only to see if it works, and how to use it. When the number of tests started to grow, I started searching for the automatic test generation. I found idea sparking <a class="link" href="http://blog.colinbreck.com/programmatically-generating-tests-using-a-visual-studio-t4-text-template/"  target="_blank" rel="noopener"
    >post by Colin Breck</a>, watched the <a class="link" href="https://www.pluralsight.com/courses/t4-templates"  target="_blank" rel="noopener"
    >T4 Templates course on Pluralsight</a> and prepared the solution.</p>
<p><a class="link" href="images/TestExplorer.png" >
  
  <p style="text-align: center;">
    <img src="images/TestExplorer.png"
	
	
	
	loading="lazy"
	
		alt="Test explorer"
	
	
>
  </p>

</a></p>
<p>I started by creating the template using right-click on the <code>ssisUnitLearning.MSTest</code> project, selecting <em>New Item</em> and the <em>Text Template</em>. Then I copied and pasted the content from one of the test files and modified it with two loops - for each <code>.ssisUnit</code> test file I create the class that contains the test method for each ssisUnit test. <code>ReadTestFile()</code> and <code>CleanName()</code> methods are modified versions of the code from the formerly mentioned course on Pluralsight. And that&rsquo;s it! When you compile the project, the template will generate all the test classes and methods, and they will be available in the <code>.dll</code> file to use in the <em>Test Explorer</em>. The code is available <a class="link" href="https://github.com/BartekR/ssisUnitLearning/blob/master/ssisUnitLearning.MSTest/ssisUnitTestTemplate.tt"  target="_blank" rel="noopener"
    >in the <code>ssisUnitTestTemplate.tt</code> script</a>.</p>
<h2 id="tfs-part">TFS part
</h2><p>The last thing is to use the MSTest project in the TFS build. The whole building and deployment process of the database, SSIS project, tests, configuration, etc. is a topic for one of the next posts, but for running the tests it&rsquo;s enough to:</p>
<ul>
<li>use the <em>MSBuild</em> or <em>Visual Studio Build</em> task to compile the project (I used <em>MSBuild</em>)</li>
<li>use the <em>Visual Studio Test</em> task and leave all the defaults as is</li>
</ul>
<p>You should now have the reports in TFS that show you the ssisUnit tests results.</p>
<h2 id="summary">Summary
</h2><p>Basically, to run the ssisUnit tests using <em>MSTest</em> I had to port some parts of the ssisUnitTestRunner code to the framework. Then, to automate test generation, I used T4 template to iterate through all the test files and defined tests. Now it&rsquo;s enough to prepare the next ssisUnit suite, save and compile the MSTest project to have all the tests available in Visual Studio&rsquo;s <em>Test Runner</em> or - after the project builds - in TFS.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/mstest/">MSTest</a>
        
            <a href="/tags/ssisunit/">SsisUnit</a>
        
            <a href="/tags/tfs/">TFS</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/2018/05/31/using-cached-datasets-in-ssisunit/">
        
        

        <div class="article-details">
            <h2 class="article-title">Using cached datasets in ssisUnit</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/2018/04/30/using-connections-and-datasets-in-ssisunit/">
        
        

        <div class="article-details">
            <h2 class="article-title">Using Connections and Datasets in ssisUnit</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/2018/04/13/testing-database-connections-with-ssisunit/">
        
        

        <div class="article-details">
            <h2 class="article-title">Testing database connections with ssisUnit</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/2018/03/26/writing-first-tests-with-ssisunit/">
        
        

        <div class="article-details">
            <h2 class="article-title">Writing first tests with ssisUnit</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/2018/03/19/testing-ssis-projects-with-ssisunit/">
        
        

        <div class="article-details">
            <h2 class="article-title">Testing SSIS Projects with ssisUnit</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="BartekR/bartekr.github.io"
        issue-term="url"
        
        label="blog-comment"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2017 - 
        
        2024 BartekR
    </section>
    
    <section class="powerby">
        
            (c) Bartosz Ratajczyk <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
